<?php   $lastOperatorChanged = false; $lastOperatorId = false; $messagesStats = array( 'total_messages' => count($messages), 'counter_messages' => 0, ); foreach ($messages as $msg) : $messagesStats['counter_messages']++; if ($lastOperatorId !== false && $lastOperatorId != $msg['user_id']) { $lastOperatorChanged = true; } else { $lastOperatorChanged = false; } $lastOperatorId = $msg['user_id']; ?><?php if ($msg['meta_msg'] != '') { $metaMessageData = json_decode($msg['meta_msg'], true); $messageId = $msg['id']; } else if (isset($metaMessageData)) { unset($metaMessageData); } ?><?php  if ($msg['user_id'] > -1 || $msg['user_id'] == -2) : ?><?php  if ($msg['user_id'] == 0) { ?><div class="message-row response" id="msg-<?php  echo $msg['id']?>" data-op-id="<?php  echo $msg['user_id']?>"><div class="msg-date"><?php  if (date('Ymd') == date('Ymd',$msg['time'])) { echo date(erLhcoreClassModule::$dateHourFormat,$msg['time']);} else { echo date(erLhcoreClassModule::$dateDateHourFormat,$msg['time']);}; ?></div><span class="usr-tit<?php  echo $msg['user_id'] == 0 ? ' vis-tit' : ' op-tit'?>"<?php  if ($msg['user_id'] == 0) : ?> title="Edit nick" onclick="lhinst.eNick()" role="button"<?php  endif;?>><i class="material-icons chat-operators mi-fs15 mr-0">face</i><?php  echo htmlspecialchars($chat->nick)?></span><?php  if ($msg['msg'] != '') : ?><div class="msg-body"><?php  if (isset($metaMessageData['content_static']['message_explain'])) : ?><span><a class="show-more" onclick="$(this).hide();$('#message-explain-<?php  echo $messageId?>').removeClass('hide')">Read more</a><span id="message-explain-<?php  echo $messageId?>" class="hide"><?php  echo htmlspecialchars(erLhcoreClassBBCode::make_clickable($metaMessageData['content_static']['message_explain']))?></span></span><?php  endif; ?><?php  echo erLhcoreClassBBCode::make_clickable(htmlspecialchars($msg['msg']))?></div><?php  endif; ?><?php  if (isset($metaMessageData)) : ?><?php  if (is_array($metaMessageData) && !isset($metaMessageData['processed']) || $metaMessageData['processed'] == false) : ?><?php  if (isset($metaMessageData['content']) && is_array($metaMessageData['content'])) : foreach ($metaMessageData['content'] as $type => $metaMessage) : ?><?php  if ($type == 'quick_replies' && (!isset($messagesStats) || $messagesStats['total_messages'] == $messagesStats['counter_messages'])) : ?><div class="meta-message meta-message-<?php  echo $messageId?>"><ul class="quick-replies list-inline meta-auto-hide"><?php  foreach ($metaMessage as $item) : ?><li><?php  if ($item['type'] == 'url') : ?><a class="btn btn-xs btn-info" target="_blank" href="<?php  echo htmlspecialchars($item['content']['payload'])?>"><i class="material-icons">open_in_new</i><?php  echo htmlspecialchars($item['content']['name'])?></a><?php  elseif ($item['type'] == 'trigger') : ?><button type="button" class="btn btn-xs btn-info" onclick='lhinst.updateTriggerClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this))'><?php  echo htmlspecialchars($item['content']['name'])?></button><?php  elseif ($item['type'] == 'updatechat') : ?><button type="button" class="btn btn-xs btn-info" onclick='lhinst.updateChatClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this))'><?php  echo htmlspecialchars($item['content']['name'])?></button><?php  else : ?><button type="button" class="btn btn-xs btn-info" onclick='lhinst.buttonClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this))'><?php  echo htmlspecialchars($item['content']['name'])?></button><?php  endif?></li><?php  endforeach; ?></ul></div><?php  elseif ($type == 'dropdown' && (!isset($messagesStats) || $messagesStats['total_messages'] == $messagesStats['counter_messages'])) : ?><div class="meta-message meta-message-<?php  echo $messageId?>"><div class="p5 meta-auto-hide p5 pl0"><div class="form-group mb5"><?php  echo erLhcoreClassRenderHelper::renderCombobox( array ( 'input_name' => 'generic_list-' . $messageId, 'optional_field' => 'Please choose', 'selected_id' => (isset($metaMessage['provider_default']) ? $metaMessage['provider_default'] : 0), 'css_class' => 'form-control input-sm', 'attr_id' => $metaMessage['provider_id'], 'display_name' => $metaMessage['provider_name'], 'list_function' => $metaMessage['provider_dropdown'], 'list_function_params' => $metaMessage['provider_arguments'], )); ?></div><button type="button" class="btn btn-xs btn-info" onclick="lhinst.dropdownClicked(<?php  echo $messageId?>,$(this))">Choose</button></div></div><?php  elseif ($type == 'buttons' && (!isset($messagesStats) || $messagesStats['total_messages'] == $messagesStats['counter_messages'])) : ?><?php  if (is_callable($metaMessage['render_function'])) : $metaMessage = call_user_func_array($metaMessage['render_function'], $metaMessage['render_args']) ?><div class="meta-message meta-message-<?php  echo $messageId?>"><ul class="quick-replies list-inline meta-auto-hide"><?php  foreach ($metaMessage as $item) : ?><li><?php  if ($item['type'] == 'url') : ?><a class="btn btn-xs btn-info" target="_blank" href="<?php  echo htmlspecialchars($item['content']['payload'])?>"><i class="material-icons">open_in_new</i><?php  echo htmlspecialchars($item['content']['name'])?></a><?php  elseif ($item['type'] == 'trigger') : ?><button type="button" class="btn btn-xs btn-info" onclick='lhinst.updateTriggerClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this))'><?php  echo htmlspecialchars($item['content']['name'])?></button><?php  elseif ($item['type'] == 'updatechat') : ?><button type="button" class="btn btn-xs btn-info" onclick='lhinst.updateChatClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this))'><?php  echo htmlspecialchars($item['content']['name'])?></button><?php  else : ?><button type="button" class="btn btn-xs btn-info" onclick='lhinst.buttonClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this))'><?php  echo htmlspecialchars($item['content']['name'])?></button><?php  endif?></li><?php  endforeach; ?></ul></div><?php  else : ?><div class="msg-body">Could not call <?php  echo htmlspecialchars($metaMessage['render_function'])?> with args <?php  echo htmlspecialchars($metaMessage['render_args'])?></div><?php  endif; ?><?php  elseif ($type == 'custom' && (!isset($messagesStats) || $messagesStats['total_messages'] == $messagesStats['counter_messages'])) : ?><div class="meta-auto-hide meta-message-<?php  echo $messageId?>"><?php  if (is_callable($metaMessage['render_function'])) : $argsCall = $metaMessage['render_args']; $argsCall[] = $messageId; $metaMessageContent = call_user_func_array($metaMessage['render_function'],$argsCall) ?><?php  echo $metaMessageContent?><?php  else : ?><p>Function is not callable <?php  echo htmlspecialchars($metaMessage['render_function'])?></p><?php  endif; ?></div><?php  elseif ($type == 'collected_summary') : ?><div class="meta-message"><div class="p5 "><ul class="quick-replies"><?php  foreach ($metaMessage as $item) : ?><li><?php  echo htmlspecialchars($item['name'])?> - <?php  echo htmlspecialchars(isset($item['value_literal']) ? $item['value_literal'] : $item['value']) ?></li><?php  endforeach; ?></ul><?php  if (!isset($messagesStats) || $messagesStats['total_messages'] == $messagesStats['counter_messages']) : ?><div class="meta-auto-hide meta-message-<?php  echo $messageId?>"><?php  if (isset($metaMessageData['content']['collectable_options']['show_summary_checkbox']) && $metaMessageData['content']['collectable_options']['show_summary_checkbox'] == true) : ?><div><label><input type="checkbox" value="on" onchange="($(this).is(':checked') ? $('#confirm-button-<?php  echo $messageId?>').removeClass('hide') : $('#confirm-button-<?php  echo $messageId?>').addClass('hide'));$('#messagesBlock').stop(true,false).animate({ scrollTop: $('#messagesBlock').prop('scrollHeight') }, 500);" /><?php  if (isset($metaMessageData['content']['collectable_options']['show_summary_checkbox_name'])) : ?><?php  echo htmlspecialchars($metaMessageData['content']['collectable_options']['show_summary_checkbox_name'])?><?php  endif?></label></div><?php  endif; ?><div id="confirm-button-<?php  echo $messageId?>" class="pb5 <?php  if (isset($metaMessageData['content']['collectable_options']['show_summary_checkbox']) && $metaMessageData['content']['collectable_options']['show_summary_checkbox'] == true) : ?> hide<?php  endif?>"><button type="button" class="btn btn-xs btn-info" onclick="lhinst.buttonClicked('confirm',<?php  echo $messageId?>,$(this))"><?php  if (isset($metaMessageData['content']['collectable_options']['show_summary_confirm_name'])) : ?><?php  echo htmlspecialchars($metaMessageData['content']['collectable_options']['show_summary_confirm_name'])?><?php  else : ?>Confirm<?php  endif?></button></div></div><?php  endif; ?></div></div><?php  elseif ($type == 'buttons_generic') : ?><div class="meta-message meta-message-<?php  echo $messageId?>"><ul class="bot-btn-list"><?php  foreach ($metaMessage as $indexSub => $item) : ?><li><?php  if ($item['type'] == 'url') : ?><a target="_blank" href="<?php  echo htmlspecialchars($item['content']['payload'])?>"><i class="material-icons">open_in_new</i><?php  elseif ($item['type'] == 'updatechat') : ?><a data-no-change="true" onclick='lhinst.updateChatClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  elseif ($item['type'] == 'trigger') : ?><a data-no-change="true" onclick='lhinst.updateTriggerClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  else : ?><a data-no-change="true" onclick='lhinst.buttonClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  endif?><?php  echo htmlspecialchars($item['content']['name']) ?></a></a><?php  endforeach; ?></ul></div><?php  elseif ($type == 'generic') : ?><div class="meta-message meta-message-<?php  echo $messageId?>" style="padding:10px"><div class="row"><div class="col-xs-12"><div class="generic-carousel"><?php  foreach ($metaMessage['items'] as $index => $item) : ?><div class="generic-bubble-item"><div class="generic-bubble-content"><?php  $itemLink = $item; ?><?php $linkData = array( 'start' => '', 'end' => '' ); if (isset($itemLink)) { if ($itemLink['type'] == 'url') { $linkData['start'] = '<a target="_blank" href="' . htmlspecialchars($itemLink['content']['payload']) . '">'; } elseif ($itemLink['type'] == 'updatechat') { $linkData['start'] = '<a data-no-change="true" onclick=\'lhinst.updateChatClicked(' . json_encode($itemLink['content']['payload']) .','. $messageId . ',$(this),true)\'>'; } elseif ($itemLink['type'] == 'button') { $linkData['start'] = '<a data-no-change="true" onclick=\'lhinst.buttonClicked(' . json_encode($itemLink['content']['payload']). ','. $messageId. ',$(this),true)\'>'; } elseif ($itemLink['type'] == 'trigger') { $linkData['start'] = '<a data-no-change="true" onclick=\'lhinst.updateTriggerClicked(' . json_encode($itemLink['content']['payload']). ','. $messageId. ',$(this),true)\'>'; } if ($linkData['start'] != '') { $linkData['end'] = '</a>'; } } ?><?php  if ($item['content']['img'] != '') : ?><?php  echo $linkData['start']?><img class="img-responsive" src="<?php  echo $item['content']['img']?>" /><?php  echo $linkData['end']?><?php  endif ?><h4><?php  echo $linkData['start']?><?php  echo htmlspecialchars($item['content']['title'])?><?php  echo $linkData['end']?></h4><p><?php  echo htmlspecialchars($item['content']['subtitle'])?></p><?php  if (isset($item['buttons']) && !empty($item['buttons'])) : ?><ul class="bot-btn-list"><?php  foreach ($item['buttons'] as $itemButton) : ?><li><?php  if ($itemButton['type'] == 'url') : ?><a target="_blank" href="<?php  echo htmlspecialchars($itemButton['content']['payload'])?>"><i class="material-icons">open_in_new</i><?php  elseif ($itemButton['type'] == 'updatechat') : ?><a data-no-change="true" onclick='lhinst.updateChatClicked(<?php  echo json_encode($itemButton['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  elseif ($itemButton['type'] == 'trigger') : ?><a data-no-change="true" onclick='lhinst.updateTriggerClicked(<?php  echo json_encode($itemButton['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  else : ?><a data-no-change="true" onclick='lhinst.buttonClicked(<?php  echo json_encode($itemButton['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  endif?><?php  echo htmlspecialchars($itemButton['content']['name'])?></a></li><?php  endforeach; ?></ul><?php  endif; ?></div></div><?php  endforeach; ?></div></div></div></div><?php  elseif ($type == 'list') : ?><div class="list-group meta-message meta-message-<?php  echo $messageId?>"><?php  $listCompactStyle = $metaMessageData['options']['no_highlight'] == true; ?><?php  foreach ($metaMessage['items'] as $index => $item) : ?><div class="list-group-element<?php  $listCompactStyle == true ? print ' compact' : print ' large'?>"><?php  $itemLink = $item; ?><?php $linkData = array( 'start' => '', 'end' => '' ); if (isset($itemLink)) { if ($itemLink['type'] == 'url') { $linkData['start'] = '<a target="_blank" href="' . htmlspecialchars($itemLink['content']['payload']) . '">'; } elseif ($itemLink['type'] == 'updatechat') { $linkData['start'] = '<a data-no-change="true" onclick=\'lhinst.updateChatClicked(' . json_encode($itemLink['content']['payload']) .','. $messageId . ',$(this),true)\'>'; } elseif ($itemLink['type'] == 'button') { $linkData['start'] = '<a data-no-change="true" onclick=\'lhinst.buttonClicked(' . json_encode($itemLink['content']['payload']). ','. $messageId. ',$(this),true)\'>'; } elseif ($itemLink['type'] == 'trigger') { $linkData['start'] = '<a data-no-change="true" onclick=\'lhinst.updateTriggerClicked(' . json_encode($itemLink['content']['payload']). ','. $messageId. ',$(this),true)\'>'; } if ($linkData['start'] != '') { $linkData['end'] = '</a>'; } } ?><?php  if ($listCompactStyle == false && $index == 0 && $item['content']['img'] != '') : ?><div class="element-background" style="background-image: url('<?php  echo $item['content']['img']?>')"></div><?php  endif ?><div class="row element-description-row"><div class="col-xs-9"><div class="element-description"><h4><?php  echo $linkData['start']?><?php  echo htmlspecialchars($item['content']['title'])?><?php  echo $linkData['end']?></h4><div><?php  echo htmlspecialchars($item['content']['subtitle'])?></div><?php  if (isset($item['buttons']) && !empty($item['buttons'])) : ?><ul class="quick-replies list-inline"><?php  foreach ($item['buttons'] as $itemButton) : ?><li><?php  if ($item['type'] == 'url') : ?><a class="btn btn-xs btn-info" target="_blank" href="<?php  echo htmlspecialchars($itemButton['content']['payload'])?>"><i class="material-icons">open_in_new</i><?php  elseif ($itemButton['type'] == 'updatechat') : ?><a class="btn btn-xs btn-info" data-no-change="true" onclick='lhinst.updateChatClicked(<?php  echo json_encode($itemButton['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  elseif ($itemButton['type'] == 'trigger') : ?><a class="btn btn-xs btn-info" data-no-change="true" onclick='lhinst.updateTriggerClicked(<?php  echo json_encode($itemButton['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  else : ?><a class="btn btn-xs btn-info" data-no-change="true" onclick='lhinst.buttonClicked(<?php  echo json_encode($itemButton['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  endif?><?php  echo htmlspecialchars($itemButton['content']['name'])?></a></li><?php  endforeach; ?></ul><?php  endif; ?></div></div><div class="col-xs-3"><?php  if ($item['content']['img'] != '' && ($index != 0 || $listCompactStyle == true)) : ?><?php  echo $linkData['start']?><img class="pull-right img-responsive" src="<?php  echo $item['content']['img']?>" /><?php  echo $linkData['end']?><?php  endif; ?></div></div></div><?php  endforeach; ?><?php  if (isset($metaMessage['list_quick_replies'])) : foreach ($metaMessage['list_quick_replies'] as $index => $item) : ?><div class="list-group-element button-item <?php  $listCompactStyle == true ? print ' compact' : print ' large'?>"><?php  if ($item['type'] == 'url') : ?><a target="_blank" href="<?php  echo htmlspecialchars($item['content']['payload'])?>"><i class="material-icons">open_in_new</i><?php  elseif ($item['type'] == 'updatechat') : ?><a data-no-change="true" onclick='lhinst.updateChatClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  elseif ($item['type'] == 'trigger') : ?><a data-no-change="true" onclick='lhinst.updateTriggerClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  else : ?><a data-no-change="true" onclick='lhinst.buttonClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  endif?><?php  echo htmlspecialchars($item['content']['name'])?></a></div><?php  endforeach;endif; ?></div><?php  endif; ?><?php  endforeach; endif; ?><?php  endif; ?><?php  endif; ?></div><?php  } else { ?><div class="message-row message-admin<?php  (isset($lastOperatorChanged) && $lastOperatorChanged == true ? print ' operator-changes' : '') ?>" id="msg-<?php  echo $msg['id']?>" data-op-id="<?php  echo $msg['user_id']?>"><div class="msg-date"><?php  if (date('Ymd') == date('Ymd',$msg['time'])) { echo date(erLhcoreClassModule::$dateHourFormat,$msg['time']);} else { echo date(erLhcoreClassModule::$dateDateHourFormat,$msg['time']);}; ?></div><span class="usr-tit<?php  echo $msg['user_id'] == 0 ? ' vis-tit' : ' op-tit'?>"><i class="material-icons chat-operators mi-fs15 mr-0">account_box</i><?php  echo htmlspecialchars($msg['name_support'])?></span><?php  if ($msg['msg'] != '') : ?><div class="msg-body"><?php  if (isset($metaMessageData['content_static']['message_explain'])) : ?><span><a class="show-more" onclick="$(this).hide();$('#message-explain-<?php  echo $messageId?>').removeClass('hide')">Read more</a><span id="message-explain-<?php  echo $messageId?>" class="hide"><?php  echo erLhcoreClassBBCode::make_clickable(htmlspecialchars($metaMessageData['content_static']['message_explain']))?></span></span><?php  endif; ?><?php  echo erLhcoreClassBBCode::make_clickable(htmlspecialchars($msg['msg']))?></div><?php  endif; ?><?php  if (isset($metaMessageData)) : ?><?php  if (is_array($metaMessageData) && !isset($metaMessageData['processed']) || $metaMessageData['processed'] == false) : ?><?php  if (isset($metaMessageData['content']) && is_array($metaMessageData['content'])) : foreach ($metaMessageData['content'] as $type => $metaMessage) : ?><?php  if ($type == 'quick_replies' && (!isset($messagesStats) || $messagesStats['total_messages'] == $messagesStats['counter_messages'])) : ?><div class="meta-message meta-message-<?php  echo $messageId?>"><ul class="quick-replies list-inline meta-auto-hide"><?php  foreach ($metaMessage as $item) : ?><li><?php  if ($item['type'] == 'url') : ?><a class="btn btn-xs btn-info" target="_blank" href="<?php  echo htmlspecialchars($item['content']['payload'])?>"><i class="material-icons">open_in_new</i><?php  echo htmlspecialchars($item['content']['name'])?></a><?php  elseif ($item['type'] == 'trigger') : ?><button type="button" class="btn btn-xs btn-info" onclick='lhinst.updateTriggerClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this))'><?php  echo htmlspecialchars($item['content']['name'])?></button><?php  elseif ($item['type'] == 'updatechat') : ?><button type="button" class="btn btn-xs btn-info" onclick='lhinst.updateChatClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this))'><?php  echo htmlspecialchars($item['content']['name'])?></button><?php  else : ?><button type="button" class="btn btn-xs btn-info" onclick='lhinst.buttonClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this))'><?php  echo htmlspecialchars($item['content']['name'])?></button><?php  endif?></li><?php  endforeach; ?></ul></div><?php  elseif ($type == 'dropdown' && (!isset($messagesStats) || $messagesStats['total_messages'] == $messagesStats['counter_messages'])) : ?><div class="meta-message meta-message-<?php  echo $messageId?>"><div class="p5 meta-auto-hide p5 pl0"><div class="form-group mb5"><?php  echo erLhcoreClassRenderHelper::renderCombobox( array ( 'input_name' => 'generic_list-' . $messageId, 'optional_field' => 'Please choose', 'selected_id' => (isset($metaMessage['provider_default']) ? $metaMessage['provider_default'] : 0), 'css_class' => 'form-control input-sm', 'attr_id' => $metaMessage['provider_id'], 'display_name' => $metaMessage['provider_name'], 'list_function' => $metaMessage['provider_dropdown'], 'list_function_params' => $metaMessage['provider_arguments'], )); ?></div><button type="button" class="btn btn-xs btn-info" onclick="lhinst.dropdownClicked(<?php  echo $messageId?>,$(this))">Choose</button></div></div><?php  elseif ($type == 'buttons' && (!isset($messagesStats) || $messagesStats['total_messages'] == $messagesStats['counter_messages'])) : ?><?php  if (is_callable($metaMessage['render_function'])) : $metaMessage = call_user_func_array($metaMessage['render_function'], $metaMessage['render_args']) ?><div class="meta-message meta-message-<?php  echo $messageId?>"><ul class="quick-replies list-inline meta-auto-hide"><?php  foreach ($metaMessage as $item) : ?><li><?php  if ($item['type'] == 'url') : ?><a class="btn btn-xs btn-info" target="_blank" href="<?php  echo htmlspecialchars($item['content']['payload'])?>"><i class="material-icons">open_in_new</i><?php  echo htmlspecialchars($item['content']['name'])?></a><?php  elseif ($item['type'] == 'trigger') : ?><button type="button" class="btn btn-xs btn-info" onclick='lhinst.updateTriggerClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this))'><?php  echo htmlspecialchars($item['content']['name'])?></button><?php  elseif ($item['type'] == 'updatechat') : ?><button type="button" class="btn btn-xs btn-info" onclick='lhinst.updateChatClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this))'><?php  echo htmlspecialchars($item['content']['name'])?></button><?php  else : ?><button type="button" class="btn btn-xs btn-info" onclick='lhinst.buttonClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this))'><?php  echo htmlspecialchars($item['content']['name'])?></button><?php  endif?></li><?php  endforeach; ?></ul></div><?php  else : ?><div class="msg-body">Could not call <?php  echo htmlspecialchars($metaMessage['render_function'])?> with args <?php  echo htmlspecialchars($metaMessage['render_args'])?></div><?php  endif; ?><?php  elseif ($type == 'custom' && (!isset($messagesStats) || $messagesStats['total_messages'] == $messagesStats['counter_messages'])) : ?><div class="meta-auto-hide meta-message-<?php  echo $messageId?>"><?php  if (is_callable($metaMessage['render_function'])) : $argsCall = $metaMessage['render_args']; $argsCall[] = $messageId; $metaMessageContent = call_user_func_array($metaMessage['render_function'],$argsCall) ?><?php  echo $metaMessageContent?><?php  else : ?><p>Function is not callable <?php  echo htmlspecialchars($metaMessage['render_function'])?></p><?php  endif; ?></div><?php  elseif ($type == 'collected_summary') : ?><div class="meta-message"><div class="p5 "><ul class="quick-replies"><?php  foreach ($metaMessage as $item) : ?><li><?php  echo htmlspecialchars($item['name'])?> - <?php  echo htmlspecialchars(isset($item['value_literal']) ? $item['value_literal'] : $item['value']) ?></li><?php  endforeach; ?></ul><?php  if (!isset($messagesStats) || $messagesStats['total_messages'] == $messagesStats['counter_messages']) : ?><div class="meta-auto-hide meta-message-<?php  echo $messageId?>"><?php  if (isset($metaMessageData['content']['collectable_options']['show_summary_checkbox']) && $metaMessageData['content']['collectable_options']['show_summary_checkbox'] == true) : ?><div><label><input type="checkbox" value="on" onchange="($(this).is(':checked') ? $('#confirm-button-<?php  echo $messageId?>').removeClass('hide') : $('#confirm-button-<?php  echo $messageId?>').addClass('hide'));$('#messagesBlock').stop(true,false).animate({ scrollTop: $('#messagesBlock').prop('scrollHeight') }, 500);" /><?php  if (isset($metaMessageData['content']['collectable_options']['show_summary_checkbox_name'])) : ?><?php  echo htmlspecialchars($metaMessageData['content']['collectable_options']['show_summary_checkbox_name'])?><?php  endif?></label></div><?php  endif; ?><div id="confirm-button-<?php  echo $messageId?>" class="pb5 <?php  if (isset($metaMessageData['content']['collectable_options']['show_summary_checkbox']) && $metaMessageData['content']['collectable_options']['show_summary_checkbox'] == true) : ?> hide<?php  endif?>"><button type="button" class="btn btn-xs btn-info" onclick="lhinst.buttonClicked('confirm',<?php  echo $messageId?>,$(this))"><?php  if (isset($metaMessageData['content']['collectable_options']['show_summary_confirm_name'])) : ?><?php  echo htmlspecialchars($metaMessageData['content']['collectable_options']['show_summary_confirm_name'])?><?php  else : ?>Confirm<?php  endif?></button></div></div><?php  endif; ?></div></div><?php  elseif ($type == 'buttons_generic') : ?><div class="meta-message meta-message-<?php  echo $messageId?>"><ul class="bot-btn-list"><?php  foreach ($metaMessage as $indexSub => $item) : ?><li><?php  if ($item['type'] == 'url') : ?><a target="_blank" href="<?php  echo htmlspecialchars($item['content']['payload'])?>"><i class="material-icons">open_in_new</i><?php  elseif ($item['type'] == 'updatechat') : ?><a data-no-change="true" onclick='lhinst.updateChatClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  elseif ($item['type'] == 'trigger') : ?><a data-no-change="true" onclick='lhinst.updateTriggerClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  else : ?><a data-no-change="true" onclick='lhinst.buttonClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  endif?><?php  echo htmlspecialchars($item['content']['name']) ?></a></a><?php  endforeach; ?></ul></div><?php  elseif ($type == 'generic') : ?><div class="meta-message meta-message-<?php  echo $messageId?>" style="padding:10px"><div class="row"><div class="col-xs-12"><div class="generic-carousel"><?php  foreach ($metaMessage['items'] as $index => $item) : ?><div class="generic-bubble-item"><div class="generic-bubble-content"><?php  $itemLink = $item; ?><?php $linkData = array( 'start' => '', 'end' => '' ); if (isset($itemLink)) { if ($itemLink['type'] == 'url') { $linkData['start'] = '<a target="_blank" href="' . htmlspecialchars($itemLink['content']['payload']) . '">'; } elseif ($itemLink['type'] == 'updatechat') { $linkData['start'] = '<a data-no-change="true" onclick=\'lhinst.updateChatClicked(' . json_encode($itemLink['content']['payload']) .','. $messageId . ',$(this),true)\'>'; } elseif ($itemLink['type'] == 'button') { $linkData['start'] = '<a data-no-change="true" onclick=\'lhinst.buttonClicked(' . json_encode($itemLink['content']['payload']). ','. $messageId. ',$(this),true)\'>'; } elseif ($itemLink['type'] == 'trigger') { $linkData['start'] = '<a data-no-change="true" onclick=\'lhinst.updateTriggerClicked(' . json_encode($itemLink['content']['payload']). ','. $messageId. ',$(this),true)\'>'; } if ($linkData['start'] != '') { $linkData['end'] = '</a>'; } } ?><?php  if ($item['content']['img'] != '') : ?><?php  echo $linkData['start']?><img class="img-responsive" src="<?php  echo $item['content']['img']?>" /><?php  echo $linkData['end']?><?php  endif ?><h4><?php  echo $linkData['start']?><?php  echo htmlspecialchars($item['content']['title'])?><?php  echo $linkData['end']?></h4><p><?php  echo htmlspecialchars($item['content']['subtitle'])?></p><?php  if (isset($item['buttons']) && !empty($item['buttons'])) : ?><ul class="bot-btn-list"><?php  foreach ($item['buttons'] as $itemButton) : ?><li><?php  if ($itemButton['type'] == 'url') : ?><a target="_blank" href="<?php  echo htmlspecialchars($itemButton['content']['payload'])?>"><i class="material-icons">open_in_new</i><?php  elseif ($itemButton['type'] == 'updatechat') : ?><a data-no-change="true" onclick='lhinst.updateChatClicked(<?php  echo json_encode($itemButton['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  elseif ($itemButton['type'] == 'trigger') : ?><a data-no-change="true" onclick='lhinst.updateTriggerClicked(<?php  echo json_encode($itemButton['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  else : ?><a data-no-change="true" onclick='lhinst.buttonClicked(<?php  echo json_encode($itemButton['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  endif?><?php  echo htmlspecialchars($itemButton['content']['name'])?></a></li><?php  endforeach; ?></ul><?php  endif; ?></div></div><?php  endforeach; ?></div></div></div></div><?php  elseif ($type == 'list') : ?><div class="list-group meta-message meta-message-<?php  echo $messageId?>"><?php  $listCompactStyle = $metaMessageData['options']['no_highlight'] == true; ?><?php  foreach ($metaMessage['items'] as $index => $item) : ?><div class="list-group-element<?php  $listCompactStyle == true ? print ' compact' : print ' large'?>"><?php  $itemLink = $item; ?><?php $linkData = array( 'start' => '', 'end' => '' ); if (isset($itemLink)) { if ($itemLink['type'] == 'url') { $linkData['start'] = '<a target="_blank" href="' . htmlspecialchars($itemLink['content']['payload']) . '">'; } elseif ($itemLink['type'] == 'updatechat') { $linkData['start'] = '<a data-no-change="true" onclick=\'lhinst.updateChatClicked(' . json_encode($itemLink['content']['payload']) .','. $messageId . ',$(this),true)\'>'; } elseif ($itemLink['type'] == 'button') { $linkData['start'] = '<a data-no-change="true" onclick=\'lhinst.buttonClicked(' . json_encode($itemLink['content']['payload']). ','. $messageId. ',$(this),true)\'>'; } elseif ($itemLink['type'] == 'trigger') { $linkData['start'] = '<a data-no-change="true" onclick=\'lhinst.updateTriggerClicked(' . json_encode($itemLink['content']['payload']). ','. $messageId. ',$(this),true)\'>'; } if ($linkData['start'] != '') { $linkData['end'] = '</a>'; } } ?><?php  if ($listCompactStyle == false && $index == 0 && $item['content']['img'] != '') : ?><div class="element-background" style="background-image: url('<?php  echo $item['content']['img']?>')"></div><?php  endif ?><div class="row element-description-row"><div class="col-xs-9"><div class="element-description"><h4><?php  echo $linkData['start']?><?php  echo htmlspecialchars($item['content']['title'])?><?php  echo $linkData['end']?></h4><div><?php  echo htmlspecialchars($item['content']['subtitle'])?></div><?php  if (isset($item['buttons']) && !empty($item['buttons'])) : ?><ul class="quick-replies list-inline"><?php  foreach ($item['buttons'] as $itemButton) : ?><li><?php  if ($item['type'] == 'url') : ?><a class="btn btn-xs btn-info" target="_blank" href="<?php  echo htmlspecialchars($itemButton['content']['payload'])?>"><i class="material-icons">open_in_new</i><?php  elseif ($itemButton['type'] == 'updatechat') : ?><a class="btn btn-xs btn-info" data-no-change="true" onclick='lhinst.updateChatClicked(<?php  echo json_encode($itemButton['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  elseif ($itemButton['type'] == 'trigger') : ?><a class="btn btn-xs btn-info" data-no-change="true" onclick='lhinst.updateTriggerClicked(<?php  echo json_encode($itemButton['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  else : ?><a class="btn btn-xs btn-info" data-no-change="true" onclick='lhinst.buttonClicked(<?php  echo json_encode($itemButton['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  endif?><?php  echo htmlspecialchars($itemButton['content']['name'])?></a></li><?php  endforeach; ?></ul><?php  endif; ?></div></div><div class="col-xs-3"><?php  if ($item['content']['img'] != '' && ($index != 0 || $listCompactStyle == true)) : ?><?php  echo $linkData['start']?><img class="pull-right img-responsive" src="<?php  echo $item['content']['img']?>" /><?php  echo $linkData['end']?><?php  endif; ?></div></div></div><?php  endforeach; ?><?php  if (isset($metaMessage['list_quick_replies'])) : foreach ($metaMessage['list_quick_replies'] as $index => $item) : ?><div class="list-group-element button-item <?php  $listCompactStyle == true ? print ' compact' : print ' large'?>"><?php  if ($item['type'] == 'url') : ?><a target="_blank" href="<?php  echo htmlspecialchars($item['content']['payload'])?>"><i class="material-icons">open_in_new</i><?php  elseif ($item['type'] == 'updatechat') : ?><a data-no-change="true" onclick='lhinst.updateChatClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  elseif ($item['type'] == 'trigger') : ?><a data-no-change="true" onclick='lhinst.updateTriggerClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  else : ?><a data-no-change="true" onclick='lhinst.buttonClicked(<?php  echo json_encode($item['content']['payload'])?>,<?php  echo $messageId?>,$(this),true)'><?php  endif?><?php  echo htmlspecialchars($item['content']['name'])?></a></div><?php  endforeach;endif; ?></div><?php  endif; ?><?php  endforeach; endif; ?><?php  endif; ?><?php  endif; ?></div><?php  } ?><?php  endif;?><?php  endforeach; ?>