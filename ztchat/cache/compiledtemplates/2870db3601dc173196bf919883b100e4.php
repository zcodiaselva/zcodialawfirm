<?php   ?><div class="pull-right operator-info pt5"><i class="material-icons mr-0<?php  if ($chat->fbst == 1) : ?> up-voted<?php  endif;?>">thumb_up</i><i class="material-icons<?php  if ($chat->fbst == 2) : ?> down-voted<?php  endif;?>">thumb_down</i><i id="chat-id-<?php  echo $chat->id?>-mds" data-chat-status="<?php  echo $chat->status?>" data-chat-user="<?php  echo $chat->user_id?>" class="material-icons<?php  if ($chat->has_unread_op_messages == 1) : ?> chat-unread<?php  else : ?> chat-active<?php  endif;?>">chat</i><?php  if ($canEditChat == true && (!isset($hideActionBlock) || $hideActionBlock == false)) : ?><span class="pull-right <?php  if (erLhcoreClassUser::instance()->hasAccessTo('lhchat','canchangechatstatus')) : ?> action-image<?php  endif?>" id="chat-status-text-<?php  echo $chat->id?>" <?php  if (erLhcoreClassUser::instance()->hasAccessTo('lhchat','canchangechatstatus')) : ?>title="Click to change chat status" onclick="return lhc.revealModal({'url':WWW_DIR_JAVASCRIPT +'chat/changestatus/<?php  echo $chat->id?>'})"<?php  endif;?>><i class="material-icons mr-0" title="<?php  if ($chat->status == erLhcoreClassModelChat::STATUS_PENDING_CHAT) : ?>Pending chat<?php  elseif ($chat->status == erLhcoreClassModelChat::STATUS_ACTIVE_CHAT) : ?>Active chat<?php  elseif ($chat->status == erLhcoreClassModelChat::STATUS_CLOSED_CHAT) : ?>Closed chat<?php  elseif ($chat->status == erLhcoreClassModelChat::STATUS_CHATBOX_CHAT) : ?>Chatbox chat<?php  elseif ($chat->status == erLhcoreClassModelChat::STATUS_OPERATORS_CHAT) : ?>Operators chat<?php  endif;?>">info_outline</i></span><?php  endif; ?></div><div><?php   $orderChatButtons = array( array( 'item' => 'edit_chat', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'copy_messages', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'open_new_window', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'show_survey', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'remove_dialog_tab', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'close_chat', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'delete_chat', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'transfer', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'blockuser', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'send_mail', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'redirect_contact', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'print', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'attatch_file', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'redirect_user', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'speech', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'cobrowse', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'print_archive', 'enabled' => isset($hideActionBlock) ), array( 'item' => 'mail_archive', 'enabled' => isset($hideActionBlock) ) ); ?><?php  foreach ($orderChatButtons as $buttonData) : ?><?php  if ($buttonData['enabled'] == true) : ?><?php  if ($buttonData['item'] == 'edit_chat' && $canEditChat == true) : ?><a onclick="return lhc.revealModal({'title' : 'Modify chat', 'iframe':true,'height':350,'url':WWW_DIR_JAVASCRIPT +'chat/modifychat/<?php  echo $chat->id?>/(pos)/'+$('#chat-tab-li-<?php  echo $chat->id?>').index()})" title="Edit main chat information" href="#"><i class="material-icons mr-0">mode_edit</i></a><?php  elseif ($buttonData['item'] == 'open_new_window') : ?><a class="material-icons mr-0" data-title="<?php  echo htmlspecialchars($chat->nick,ENT_QUOTES);?>" onclick="lhinst.startChatCloseTabNewWindow('<?php  echo $chat->id;?>',$('#tabs'),$(this).attr('data-title'))" title="Open in a new window">open_in_new</a><?php  elseif ($buttonData['item'] == 'show_survey' && $canEditChat == true) : ?><a class="material-icons mr-0" onclick="lhc.revealModal({'url':WWW_DIR_JAVASCRIPT +'survey/choosesurvey/<?php  echo $chat->id?>'})" title="Redirect user to survey">speaker_notes</a><?php  elseif ($buttonData['item'] == 'remove_dialog_tab') : ?><?php  elseif ($buttonData['item'] == 'close_chat' && $canEditChat == true) : ?><?php  if ($chat->user_id == erLhcoreClassUser::instance()->getUserID() || erLhcoreClassUser::instance()->hasAccessTo('lhchat','allowcloseremote')) : ?><a class="material-icons mr-0" onclick="lhinst.closeActiveChatDialog(<?php  echo $chat->id?>,$('#tabs'),true)" title="Close chat">close</a><?php  endif;?><?php  elseif ($buttonData['item'] == 'delete_chat' && $canEditChat == true) : ?><?php  if (erLhcoreClassUser::instance()->hasAccessTo('lhchat','deleteglobalchat') || (erLhcoreClassUser::instance()->hasAccessTo('lhchat','deletechat') && $chat->user_id == erLhcoreClassUser::instance()->getUserID())) : ?><a class="material-icons mr-0" onclick="lhinst.deleteChat('<?php  echo $chat->id?>',$('#tabs'),true)" title="Delete chat">delete</a><?php  endif ?><?php  elseif ($buttonData['item'] == 'transfer' && $canEditChat == true) : ?><?php  $chat_chat_tabs_actions_transfer_enabled = true;?><?php  if ($chat_chat_tabs_actions_transfer_enabled == true && erLhcoreClassUser::instance()->hasAccessTo('lhchat', 'allowtransfer')) : ?><a class="material-icons mr-0" onclick="lhc.revealModal({'url':WWW_DIR_JAVASCRIPT +'chat/transferchat/<?php  echo $chat->id?>'})" title="Transfer chat">supervisor_account</a><?php  endif; ?><?php  elseif ($buttonData['item'] == 'blockuser' && $canEditChat == true) : ?><?php  if (erLhcoreClassUser::instance()->hasAccessTo('lhchat','allowblockusers')) : ?><?php  $chat_chat_tabs_actions_blockuser_enabled = true;?><?php  if ($chat_chat_tabs_actions_blockuser_enabled == true) : ?><a class="material-icons mr-0" data-title="Are you sure?" onclick="lhinst.blockUser('<?php  echo $chat->id?>',$(this).attr('data-title'))" title="Block user">block</a><?php  endif;?><?php  endif;?><?php  elseif ($buttonData['item'] == 'send_mail') : ?><a class="material-icons mr-0 <?php  if ($chat->mail_send == 1) : ?>icon-mail-send<?php  endif; ?>" onclick="lhc.revealModal({'iframe':true,'height':500,'url':WWW_DIR_JAVASCRIPT +'chat/sendmail/<?php  echo $chat->id?>'})" title="<?php  if ($chat->mail_send == 1) : ?>Mail was send<?php  else : ?>Send mail<?php  endif;?>">mail</a><?php  elseif ($buttonData['item'] == 'redirect_contact' && $canEditChat == true) : ?><a class="material-icons mr-0" title="Redirect user to contact form." onclick="lhinst.redirectContact('<?php  echo $chat->id;?>','Are you sure?')" >reply</a><?php  elseif ($buttonData['item'] == 'print') : ?><a target="_blank" href="/zcodialawfirm/ztchat/index.php/site_admin/chat/printchatadmin/<?php  echo $chat->id?>" class="material-icons mr-0" title="Print">print</a><?php  elseif ($buttonData['item'] == 'attatch_file' && $canEditChat == true) : ?><?php  $chat_chat_tabs_actions_attatch_file_enabled = true;?><?php  if ($chat_chat_tabs_actions_attatch_file_enabled == true) : ?><a class="material-icons mr-0" onclick="return lhc.revealModal({'iframe':true,'height':500,'url':WWW_DIR_JAVASCRIPT +'file/attatchfile/<?php  echo $chat->id?>'})" title="Attach uploaded file">attach_file</a><?php  endif;?><?php  elseif ($buttonData['item'] == 'redirect_user' && $canEditChat == true) : ?><?php  if (erLhcoreClassUser::instance()->hasAccessTo('lhchat','allowredirect')) : ?><a class="material-icons mr-0" onclick="lhinst.redirectToURL('<?php  echo $chat->id?>','Please enter a URL')" title="Redirect user to another url">link</a><?php  endif;?><?php  elseif ($buttonData['item'] == 'speech' && $canEditChat == true) : ?><?php  $chat_chat_tabs_actions_speech_enabled = true;?><?php  if ($chat_chat_tabs_actions_speech_enabled == true && erLhcoreClassUser::instance()->hasAccessTo('lhspeech','change_chat_recognition')) : ?><a class="material-icons mr-0" title="Choose other than default recognition language" onclick="lhc.revealModal({'url':'/zcodialawfirm/ztchat/index.php/site_admin/speech/setchatspeechlanguage/<?php  echo $chat->id?>'})">mic_none</a><?php  endif;?><?php  elseif ($buttonData['item'] == 'cobrowse' && $canEditChat == true) : ?><?php  $chat_chat_tabs_actions_cobrowse_enabled = true;?><?php  if ($chat_chat_tabs_actions_cobrowse_enabled == true && erLhcoreClassUser::instance()->hasAccessTo('lhcobrowse', 'browse')) : ?><a title="Screen sharing" class="material-icons" href="#" onclick="return lhinst.startCoBrowse('<?php  echo $chat->id?>')">visibility</a><?php  endif;?><?php  elseif ($buttonData['item'] == 'print_archive') : ?><a class="material-icons mr-0" target="_blank" href="/zcodialawfirm/ztchat/index.php/site_admin/chatarchive/printchatadmin/<?php  echo $archive->id?>/<?php  echo $chat->id?>">print</a><?php  elseif ($buttonData['item'] == 'mail_archive') : ?><a class="material-icons mr-0" onclick="return lhc.revealModal({'iframe':true,'height':500,'url':WWW_DIR_JAVASCRIPT +'chatarchive/sendmail/<?php  echo $archive->id?>/<?php  echo $chat->id?>'})">mail</a><?php  elseif ($buttonData['item'] == 'copy_messages') : ?><a class="material-icons" onclick="lhc.revealModal({'url':WWW_DIR_JAVASCRIPT +'chat/copymessages/<?php  echo $chat->id?>'})" title="Copy messages to clipboard">&#xE14D;</a><?php  endif; ?><?php  endif; ?><?php  endforeach; ?><?php   ?></div><?php $orderInformation = array( array( 'item' => 'department', 'enabled' => true ), array( 'item' => 'subject', 'enabled' => true ), array( 'item' => 'product', 'enabled' => true ), array( 'item' => 'uagent', 'enabled' => true ), array( 'item' => 'country_code', 'enabled' => true ), array( 'item' => 'user_tz_identifier', 'enabled' => true ), array( 'item' => 'city', 'enabled' => true ), array( 'item' => 'ip', 'enabled' => true ), array( 'item' => 'referrer', 'enabled' => true ), array( 'item' => 'session_referrer', 'enabled' => true ), array( 'item' => 'id', 'enabled' => true ), array( 'item' => 'email', 'enabled' => true ), array( 'item' => 'phone', 'enabled' => true ), array( 'item' => 'additional_data', 'enabled' => true ), array( 'item' => 'created', 'enabled' => true ), array( 'item' => 'user_left', 'enabled' => true ), array( 'item' => 'wait_time', 'enabled' => true ), array( 'item' => 'chat_duration', 'enabled' => true ), array( 'item' => 'chat_status', 'enabled' => true ), array( 'item' => 'chat_owner', 'enabled' => true ) ); ?><?php ?><table class="table table-condensed"><?php  foreach ($orderInformation as $buttonData) : ?><?php  if ($buttonData['enabled'] == true) : ?><?php  if ($buttonData['item'] == 'department') : ?><?php   ?><?php  if ( $chat->department !== false ) : ?><tr><td>Department</td><td><?php  if ($chat->status_sub == erLhcoreClassModelChat::STATUS_SUB_OFFLINE_REQUEST) : ?><i title="This is offline message" class="material-icons">mail</i><?php  endif?><?php  echo htmlspecialchars($chat->department);?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'product') : ?><?php  if ($chat->product !== false) : ?><tr><td>Product</td><td><?php  echo htmlspecialchars($chat->product);?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'uagent') : ?><?php  if ( !empty($chat->uagent) ) : ?><tr><td>Device</td><td><i class="material-icons" title="<?php  echo htmlspecialchars($chat->uagent)?>"><?php  echo ($chat->device_type == 0 ? 'computer' : ($chat->device_type == 1 ? 'smartphone' : 'tablet')) ?></i><?php  echo ($chat->device_type == 0 ? 'Computer' : ($chat->device_type == 1 ? 'Smartphone' : 'Tablet')) ?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'subject') : ?><tr><td>Subject</td><td><?php  $subjectsChat = erLhAbstractModelSubjectChat::getList(array('filter' => array('chat_id' => $chat->id))); foreach ($subjectsChat as $subject) : ?><a class="btn btn-xs btn-info"><?php  echo htmlspecialchars($subject)?></a>&nbsp;<?php  endforeach; ?><a class="btn btn-xs btn-success" onclick="return lhc.revealModal({'url':'/zcodialawfirm/ztchat/index.php/site_admin/chat/subject/<?php  echo $chat->id?>'})"><i class="material-icons mr-0">&#xE145;</i></a></td></tr><?php  elseif ($buttonData['item'] == 'country_code') : ?><?php  if ( !empty($chat->country_code) ) : ?><tr><td>Country</td><td><img src="/zcodialawfirm/ztchat/design/defaulttheme/images/flags/<?php  echo $chat->country_code?>.png" alt="<?php  echo htmlspecialchars($chat->country_name)?>" title="<?php  echo htmlspecialchars($chat->country_name)?>" />&nbsp;<?php  echo htmlspecialchars($chat->chat_locale)?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'user_tz_identifier') : ?><?php  if ( !empty($chat->user_tz_identifier) ) : ?><tr><td>Time zone</td><td><?php  echo htmlspecialchars($chat->user_tz_identifier)?>, <?php  echo htmlspecialchars($chat->user_tz_identifier_time)?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'city') : ?><?php  if ( !empty($chat->city) ) : ?><tr><td>City</td><td><?php  echo htmlspecialchars($chat->city);?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'ip') : ?><tr><td>IP</td><td><?php  echo htmlspecialchars($chat->ip)?></td></tr><?php  elseif ($buttonData['item'] == 'referrer') : ?><?php  if (!empty($chat->referrer)) : ?><tr><td>Page</td><td><div class="page-url"><span><?php  echo $chat->referrer != '' ? '<a target="_blank" rel="noopener" title="' . htmlspecialchars($chat->referrer) . '" href="' .htmlspecialchars($chat->referrer). '">'.htmlspecialchars($chat->referrer).'</a>' : ''?></span></div></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'session_referrer') : ?><?php  if (!empty($chat->session_referrer)) : ?><tr><td>Came from</td><td><div class="page-url"><span><?php  echo $chat->session_referrer != '' ? '<a target="_blank" rel="noopener" title="' . htmlspecialchars($chat->session_referrer) . '" href="' . htmlspecialchars($chat->session_referrer) . '">'.htmlspecialchars($chat->session_referrer).'</a>' : ''?></span></div></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'id') : ?><tr><td>ID</td><td><?php  echo $chat->id;?></td></tr><?php  elseif ($buttonData['item'] == 'email') : ?><?php  if (!empty($chat->email)) : ?><tr><td>E-mail</td><td><a href="mailto:<?php  echo $chat->email?>"><?php  echo $chat->email?></a></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'phone') : ?><?php  if (!empty($chat->phone)) : ?><tr><td>Phone</td><td><?php  echo htmlspecialchars($chat->phone)?></td></tr><?php  endif;?><?php   ?><?php  elseif ($buttonData['item'] == 'additional_data') : ?><?php  if (!empty($chat->additional_data)) : ?><tr><td><a class="btn btn-default btn-xs" onclick="lhinst.addRemoteCommand('<?php  echo $chat->id?>','lhc_cfrefresh');$('#custom-data-td-<?php  echo $chat->id?>').text('...')" title="Refresh"><i class="material-icons mr-0">&#xE5D5;</i></a>&nbsp;Additional data</td><td id="custom-data-td-<?php  echo $chat->id?>"><?php  if (is_array($chat->additional_data_array)) : ?><ul class="circle mb0"><?php  foreach ($chat->additional_data_array as $addItem) : ?><li><?php  echo htmlspecialchars($addItem->key)?> - <?php  echo htmlspecialchars($addItem->value)?><?php  if (isset($addItem->h) && $addItem->h == true) : ?>&nbsp;<i class="material-icons" title="Hidden field">visibility_off</i><?php  endif;?></li><?php  endforeach;?></ul><?php  else : ?><?php  echo htmlspecialchars($chat->additional_data)?><?php  endif;?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'created') : ?><tr><td colspan="2">Created at - <?php  echo $chat->time_created_front?><?php  if ($chat->pnd_time != $chat->time && $chat->pnd_time > 0) : ?>, Started at - <?php  echo $chat->pnd_time_front?><?php  endif; ?><?php  if ($chat->cls_time > 0 && $chat->status == erLhcoreClassModelChat::STATUS_CLOSED_CHAT) : ?>, Closed at - <?php  echo $chat->cls_time_front?><?php  endif;?></td></tr><?php  elseif ($buttonData['item'] == 'user_left') : ?><?php  if ($chat->user_closed_ts > 0 && $chat->user_status == 1) : ?><tr><td>User left</td><td><?php  echo $chat->user_closed_ts_front?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'wait_time') : ?><?php  if ($chat->wait_time > 0) : ?><tr><td>Waited</td><td><?php  echo $chat->wait_time_front?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'chat_duration') : ?><tr><td>Chat duration</td><td id="chat-duration-<?php  echo $chat->id?>"><?php  echo $chat->chat_duration_front?></td></tr><?php  elseif ($buttonData['item'] == 'chat_status') : ?><?php  if ($chat->status == erLhcoreClassModelChat::STATUS_OPERATORS_CHAT) : ?><tr><td>Chat between operators, chat initializer</td><td><?php  echo htmlspecialchars($chat->nick)?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'chat_owner') : ?><tr><td>Chat owner</td><td><?php  $user = $chat->getChatOwner(); if ($user !== false) : ?><?php  echo htmlspecialchars($user->name.' '.$user->surname)?><?php  endif; ?></td></tr><?php  else : ?><?php ?><?php  endif;?><?php  endif; ?><?php  endforeach; ?></table>