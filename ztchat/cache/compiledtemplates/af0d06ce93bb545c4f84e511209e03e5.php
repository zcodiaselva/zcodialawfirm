<?php  $chat_startchat_enabled = true;?><?php  if ($chat_startchat_enabled == true) : ?><?php  if ($disabled_department === true) : ?><h4>Department is disabled</h4><?php  elseif (isset($department_invalid) && $department_invalid === true) : ?><?php  $errors[] ='Please provide a department';?><?php  if (isset($errors)) : ?><div data-alert class="alert alert-danger alert-dismissible fade in"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><ul class="validation-ul"><?php  foreach ($errors as $err) : ?><li><?php  echo $err?></li><?php  endforeach;?></ul></div><?php  endif;?><?php  else : ?><?php $exitTemplate = false; $statusGeoAdjustment = erLhcoreClassChat::getAdjustment(array (0 => false,'use_geo_adjustment' => false,'available_for' => '','other_countries' => 'custom','hide_for' => '','other_status' => 'offline','rest_status' => 'hidden','apply_widget' => 0,), $input_data->vid); if ($statusGeoAdjustment['status'] == 'offline') { $forceoffline = true; $leaveamessage = true; } elseif ($statusGeoAdjustment['status'] == 'hidden') { $errors = array('Live support is not available in your country'); ?><?php  if (isset($errors)) : ?><div data-alert class="alert alert-danger alert-dismissible fade in"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><ul class="validation-ul"><?php  foreach ($errors as $err) : ?><li><?php  echo $err?></li><?php  endforeach;?></ul></div><?php  endif;?><?php  $exitTemplate = true; } ?><?php  if ($exitTemplate == true) return; ?><?php  if (isset($errors)) : ?><?php  if (isset($errors)) : ?><div data-alert class="alert alert-danger alert-dismissible fade in"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><ul class="validation-ul"><?php  foreach ($errors as $err) : ?><li><?php  echo $err?></li><?php  endforeach;?></ul></div><?php  endif;?><?php  endif; ?><?php  if ($leaveamessage == false || ($forceoffline === false && erLhcoreClassChat::isOnline($department,false,array('ignore_user_status'=> (int)'0', 'online_timeout' => (int)'300'))) === true) : ?><h4>Fill out this form to start a chat</h4><form class="fsc1" id="form-start-chat" method="post" action="/zcodialawfirm/ztchat/index.php/chat/startchat<?php  $department !== false ? print '/(department)/'.$department : ''?><?php  $input_data->priority !== false ? print '/(priority)/'.$input_data->priority : ''?><?php  $input_data->vid !== false ? print '/(vid)/'.htmlspecialchars($input_data->vid) : ''?><?php  $input_data->hash_resume !== false ? print '/(hash_resume)/'.htmlspecialchars($input_data->hash_resume) : ''?><?php  echo $append_mode_theme?>" onsubmit="return lhinst.addCaptcha('<?php  echo time()?>',$(this))"><?php  $formResubmitId = 'form-start-chat'; ?><?php   if (isset($errors['captcha']) && !isset($_POST['ResubmitCaptcha'])) : ?><input type="hidden" name="ResubmitCaptcha" value="true" /><script>$( document ).ready(function() {<?php  if (!(isset($start_data_fields['message_auto_start']) && $start_data_fields['message_auto_start'] == true)) : ?>$('#<?php  echo $formResubmitId?>').submit();<?php  endif;?>});</script><?php  endif;?><?php  if (isset($start_data_fields['name_visible_in_popup']) && $start_data_fields['name_visible_in_popup'] == true) : ?><?php  if (isset($start_data_fields['name_hidden']) && $start_data_fields['name_hidden'] == true) : ?><input type="hidden" name="Username" value="<?php  echo htmlspecialchars($input_data->username);?>" /><?php  else : ?><?php  if (in_array('username', $input_data->hattr)) : ?><input class="form-control<?php  if (isset($errors['nick'])) : ?> has-error<?php  endif;?>" type="hidden" name="Username" value="<?php  echo htmlspecialchars($input_data->username);?>" /><?php  else : ?><div class="form-group<?php  if (isset($errors['nick'])) : ?> has-error<?php  endif;?>"><label class="control-label" >Name<?php  if (isset($start_data_fields['name_require_option']) && $start_data_fields['name_require_option'] == 'required') : ?>*<?php  endif;?></label><input maxlength="100" autofocus="autofocus" <?php  if (isset($start_data_fields['name_require_option']) && $start_data_fields['name_require_option'] == 'required') : ?>aria-required="true" required<?php  endif;?> aria-label="Enter your name" placeholder="Enter your name" class="form-control" type="text" pattern="^[a-zA-Z]{1,20}" name="Username" value="<?php  echo htmlspecialchars($input_data->username);?>" /></div><?php  endif; ?><?php  endif; ?><?php  endif; ?><?php   ?><?php  if (isset($start_data_fields['email_hidden']) && $start_data_fields['email_hidden'] == true) : ?><input type="hidden" name="Email" value="<?php  echo htmlspecialchars($input_data->email);?>" /><?php  else : ?><?php  if (in_array('email', $input_data->hattr)) : ?><input class="form-control" type="hideen" name="Email" value="<?php  echo htmlspecialchars($input_data->email);?>" /><?php  else : ?><div class="form-group<?php  if (isset($errors['email'])) : ?> has-error<?php  endif;?>"><label class="control-label">E-mail<?php  if (isset($start_data_fields['email_require_option']) && $start_data_fields['email_require_option'] == 'required') : ?>*<?php  endif;?></label><input autofocus="autofocus" <?php  if (isset($start_data_fields['email_require_option']) && $start_data_fields['email_require_option'] == 'required') : ?>aria-required="true" required<?php  endif;?> aria-label="Enter your email address" placeholder="Enter your email address" class="form-control" type="email" name="Email" value="<?php  echo htmlspecialchars($input_data->email);?>" /></div><?php  endif; ?><?php  endif; ?><?php  ?><?php  ?><?php  if (isset($start_data_fields['phone_hidden']) && $start_data_fields['phone_hidden'] == true) : ?><input type="hidden" name="Phone" value="<?php  echo htmlspecialchars($input_data->phone);?>" /><?php  else : ?><?php  if (in_array('phone', $input_data->hattr)) : ?><input class="form-control" type="hidden" name="Phone" value="<?php  echo htmlspecialchars($input_data->phone);?>" /><?php  else : ?><div class="form-group<?php  if (isset($errors['phone'])) : ?> has-error<?php  endif;?>"><label class="control-label">Phone<?php  if (isset($start_data_fields['phone_require_option']) && $start_data_fields['phone_require_option'] == 'required') : ?>*<?php  endif;?></label><input autofocus="autofocus" <?php  if (isset($start_data_fields['phone_require_option']) && $start_data_fields['phone_require_option'] == 'required') : ?>aria-required="true" required<?php  endif;?> aria-label="Enter your phone" pattern="^\d{10}$" placeholder="Enter your phone" class="form-control" type="text" name="Phone" value="<?php  echo htmlspecialchars($input_data->phone);?>" /></div><?php  endif; ?><?php  endif; ?><?php  ?><?php  $adminCustomFieldsMode = 'on';?><?php   if (isset($start_data_fields['custom_fields']) && $start_data_fields['custom_fields'] != '') : $customAdminfields = json_decode($start_data_fields['custom_fields'],true); if (is_array($customAdminfields)) : ?><div class="row"><?php  foreach ($customAdminfields as $key => $adminField) : if ($adminField['visibility'] == 'all' || $adminCustomFieldsMode == $adminField['visibility']) : ?><?php  if ($adminField['fieldtype'] == 'hidden' || (isset($input_data->via_hidden[$key]) && $input_data->via_hidden[$key] == 't')) : ?><?php  if (isset($input_data->via_hidden[$key]) && $input_data->via_hidden[$key] == 't') : ?><input class="form-control" type="hidden" name="via_hidden[<?php  echo $key?>]" value="t" /><?php  endif;?><?php  if (isset($input_data->via_encrypted[$key]) && $input_data->via_encrypted[$key] == 't') : ?><input class="form-control" type="hidden" name="via_encrypted[<?php  echo $key?>]" value="t" /><?php  endif;?><input class="form-control" type="hidden" name="value_items_admin[<?php  echo $key?>]" value="<?php  isset($input_data->value_items_admin[$key]) ? print htmlspecialchars($input_data->value_items_admin[$key]) : print htmlspecialchars($adminField['defaultvalue'])?>" /><?php  elseif ($adminField['fieldtype'] == 'dropdown') : ?><?php  if (!isset($adminField['showcondition']) || $adminField['showcondition'] == 'always' || ($adminField['showcondition'] == 'uempty' && ($input_data->username == '' || isset($_POST['show_admin_item'][$key])))) : ?><input type="hidden" name="show_admin_item[<?php  echo $key?>]" value="true" /><div class="col-xs-<?php  echo htmlspecialchars($adminField['size'])?>"><div class="form-group<?php  if (isset($errors['additional_admin_'.$key])) : ?> has-error<?php  endif;?>"><label class="control-label" id="label-<?php  echo htmlspecialchars('additional_admin_'.$key)?>"><?php  echo htmlspecialchars($adminField['fieldname'])?>&nbsp;<?php  $adminField['isrequired'] == 'true' ? print '*' : ''?></label><select name="value_items_admin[<?php  echo $key?>]" class="form-control"><option value="">Please choose</option><?php  foreach (explode("\n",$adminField['options']) as $option) : ?><option <?php  isset($input_data->value_items_admin[$key]) && $option == $input_data->value_items_admin[$key] ? print 'selected="selected"' : ''?> value="<?php  echo htmlspecialchars($option)?>"><?php  echo htmlspecialchars($option)?></option><?php  endforeach; ?></select></div></div><?php  endif; ?><?php  else : $hasExtraField = true; ?><?php  if (!isset($adminField['showcondition']) || $adminField['showcondition'] == 'always' || ($adminField['showcondition'] == 'uempty' && ($input_data->username == '' || isset($_POST['show_admin_item'][$key])))) : ?><input type="hidden" name="show_admin_item[<?php  echo $key?>]" value="true" /><div class="col-xs-<?php  echo htmlspecialchars($adminField['size'])?>"><div class="form-group<?php  if (isset($errors['additional_admin_'.$key])) : ?> has-error<?php  endif;?>"><label class="control-label" id="label-<?php  echo htmlspecialchars('additional_admin_'.$key)?>"><?php  echo htmlspecialchars($adminField['fieldname'])?>&nbsp;<?php  $adminField['isrequired'] == 'true' ? print '*' : ''?></label><input class="form-control" aria-labelledby="label-<?php  echo htmlspecialchars('additional_admin_'.$key)?>" type="text" name="value_items_admin[<?php  echo $key?>]" <?php  $adminField['isrequired'] == 'true' ? print 'aria-required="true" required' : ''?> value="<?php  isset($input_data->value_items_admin[$key]) ? print htmlspecialchars($input_data->value_items_admin[$key]) : print htmlspecialchars($adminField['defaultvalue'])?>" /></div></div><?php  endif; ?><?php  endif; endif; endforeach;?></div><?php  endif; endif;?><?php  if (isset($start_data_fields['message_visible_in_popup']) && $start_data_fields['message_visible_in_popup'] == true) : ?><?php  if (isset($start_data_fields['message_hidden']) && $start_data_fields['message_hidden'] == true) : ?><textarea class="hide" placeholder="Enter your message" name="Question"><?php  echo htmlspecialchars($input_data->question);?></textarea><?php  else : ?><div class="form-group<?php  if (isset($errors['question'])) : ?> has-error<?php  endif;?>"><label class="control-label">Your question<?php  if (isset($start_data_fields['message_require_option']) && $start_data_fields['message_require_option'] == 'required') : ?>*<?php  endif;?></label><textarea autofocus="autofocus" <?php  if (isset($start_data_fields['message_require_option']) && $start_data_fields['message_require_option'] == 'required') : ?>aria-required="true" required<?php  endif;?> aria-label="Enter your message" class="form-control" placeholder="Enter your message" name="Question"><?php  echo htmlspecialchars($input_data->question);?></textarea></div><?php  endif; ?><?php  endif; ?><?php   $modeUserVariables = isset($modeUserVariables) ? $modeUserVariables : 'on'; if (!empty($input_data->name_items)) { $hasExtraField = true; }; foreach ($input_data->name_items as $item) : ?><input type="hidden" name="name_items[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;?><?php  if (isset($input_data->value_sizes)) : foreach ($input_data->value_sizes as $item) : ?><input type="hidden" name="value_sizes[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php  if (isset($input_data->values_req)) : foreach ($input_data->values_req as $item) : ?><input type="hidden" name="values_req[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php  if (isset($input_data->value_show)) : foreach ($input_data->value_show as $item) : ?><input type="hidden" name="value_show[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php  if (isset($input_data->hattr)) : foreach ($input_data->hattr as $item) : ?><input type="hidden" name="hattr[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php  if (isset($input_data->encattr)) : foreach ($input_data->encattr as $item) : ?><input type="hidden" name="encattr[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php $hasVisibleField = false; foreach ($input_data->value_types as $key => $item) : $showField = ($input_data->value_show[$key] == $modeUserVariables || $input_data->value_show[$key] == 'b'); ($hasVisibleField = ($item == 'text' && $showField == true) ? true : $hasVisibleField); ?><input type="hidden" name="value_types[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;?><?php  if ($hasVisibleField == true) : ?><div class="row"><?php  endif;?><?php  foreach ($input_data->value_items as $key => $item) : $showField = ($input_data->value_show[$key] == $modeUserVariables || $input_data->value_show[$key] == 'b'); $visibleItem = (isset($input_data->value_types[$key]) && $input_data->value_types[$key] == 'text' && isset($input_data->name_items[$key])); ?><?php  if ($visibleItem == true && $showField == true) : ?><div class="form-group col-xs-<?php  isset($input_data->value_sizes[$key]) ? print (int)$input_data->value_sizes[$key] : print 6?><?php  if (isset($errors['additional_'.$key])) : ?> has-error<?php  endif;?>"><label class="control-label"><?php  echo htmlspecialchars($input_data->name_items[$key])?><?php  isset($input_data->values_req[$key]) && $input_data->values_req[$key] == 't' ? print '*' : ''?></label><?php  endif;?><input class="form-control" type="<?php  isset($input_data->value_types[$key]) && $showField == true ? print htmlspecialchars($input_data->value_types[$key]) : print 'hidden' ?>" name="value_items[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  if ($visibleItem == true && $showField == true) : ?></div><?php  endif;?><?php  endforeach;?><?php  if ($hasVisibleField == true) : ?></div><?php  endif;?><input type="hidden" name="user_timezone" value="" /><script>$(document).ready(function() {Date.prototype.stdTimezoneOffset = function() {var jan = new Date(this.getFullYear(), 0, 1);var jul = new Date(this.getFullYear(), 6, 1);return Math.max(jan.getTimezoneOffset(), jul.getTimezoneOffset());};Date.prototype.dst = function() {return this.getTimezoneOffset() < this.stdTimezoneOffset();};var today = new Date();var timeZoneOffset = 0;if (today.dst()) {timeZoneOffset = today.getTimezoneOffset();} else {timeZoneOffset = today.getTimezoneOffset()-60;};$('input[name=user_timezone]').val(((timeZoneOffset)/60) * -1);});</script><?php  if ($department === false) : ?><?php if ('0' == 1) { $filter = array('sort' => 'priority ASC, name ASC'); if (isset($input_data->product_id_array) && !empty($input_data->product_id_array)) { $filter['filterin']['id'] = $input_data->product_id_array; } if (isset($input_data->departament_id_array) && !empty($input_data->departament_id_array)) { $filter['filterin']['departament_id'] = $input_data->departament_id_array; } if ($input_data->departament_id > 0) { $filter['filterin']['departament_id'][] = $input_data->departament_id; } $filter['filter']['disabled'] = 0; if ('0' == 0) { $products = erLhAbstractModelProduct::getList($filter); if (!empty($products)) { $departmentsOptions['hide_department'] = true; } } elseif ('0' == 1) { ?><script>$(document).ready(function() {function updateProducts(dep_id) {$.getJSON("/zcodialawfirm/ztchat/index.php/product/getproducts/" + dep_id + "/<?php  echo $input_data->product_id?>", function(data) {$('#ProductContainer').html(data.result);});};$('#id_DepartamentID').change(function() {updateProducts($(this).val());});updateProducts($('#id_DepartamentID').find('option:selected').val());});</script><?php  } } $filter = array('filter' => array('disabled' => 0, 'hidden' => 0)); if (isset($input_data->departament_id_array)) { $filter['filterin']['id'] = $input_data->departament_id_array; } $filter['sort'] = 'sort_priority ASC, name ASC'; $departments = erLhcoreClassModelDepartament::getList($filter); if (count($departments) > 1) : $hasExtraField = true;?><?php  if (isset($input_data->departament_id_array)) : foreach ($input_data->departament_id_array as $definedDep) : ?><input type="hidden" name="DepartmentIDDefined[]" value="<?php  echo $definedDep?>" /><?php  endforeach; endif; ?><?php  if (!isset($departmentsOptions['hide_department']) || $departmentsOptions['hide_department'] == false) : ?><div class="form-group<?php  if (isset($errors['department'])) : ?> has-error<?php  endif;?>"><label class="control-label" id="label-department"><?php  if (isset($theme) && $theme !== false && $theme->department_title != '') : ?><?php  echo htmlspecialchars($theme->department_title)?><?php  else : ?>Department<?php  endif;?></label><select aria-labelledby="label-department" class="form-control" name="DepartamentID" id="id_DepartamentID"><?php  if (isset($theme) && $theme !== false && $theme->department_select != '') : ?><option value="-1"><?php  echo htmlspecialchars($theme->department_select)?></option><?php  endif;?><?php  $departments = erLhcoreClassDepartament::sortByStatus($departments); foreach ($departments as $departament) : $isOnline = erLhcoreClassChat::isOnline($departament->id,false,array('ignore_user_status'=> (int)'0', 'online_timeout' => (int)'300')); ?><?php  if (($departament->visible_if_online == 1 && $isOnline === true) || $departament->visible_if_online == 0) : ?><option data-attr-online="<?php  if ($isOnline === false) : ?>false<?php  else : ?>true<?php  endif;?>" <?php  if ($isOnline === false) : ?>class="offline-dep"<?php  endif;?> value="<?php  echo $departament->id?>" <?php  isset($input_data->departament_id) && $input_data->departament_id == $departament->id ? print 'selected="selected"' : '';?> ><?php  echo htmlspecialchars($departament->name)?><?php  if ($isOnline === false) : ?>&nbsp;&nbsp;--=Offline=--<?php  endif;?></option><?php  endif;?><?php  endforeach; ?></select></div><?php  endif; endif; ?><?php  endif;?><?php if ('0' == 1) : if (!empty($products) || '0' == 1) : ?><input type="hidden" name="HasProductID" value="on" /><?php  if (isset($input_data->product_id_array)) : foreach ($input_data->product_id_array as $definedProduct) : ?><input type="hidden" name="ProductIDDefined[]" value="<?php  echo $definedProduct?>" /><?php  endforeach; endif; ?><div class="form-group<?php  if (isset($errors['ProductID'])) : ?> has-error<?php  endif;?>" id="ProductContainer"><?php  if ('0' == 0) : ?><label class="control-label">Product*</label><select class="form-control" name="ProductID" id="ProductID_id"><option value="">Choose a product</option><?php  foreach ($products as $product) : ?><option value="<?php  echo $product->id?>" <?php  if ($input_data->product_id == $product->id) : ?>selected="selected"<?php  endif;?> ><?php  echo htmlspecialchars($product->name)?></option><?php  endforeach;?></select><?php  endif;?></div><?php  endif; endif; ?><?php  $tosVariable = 'tos_visible_in_popup';$tosCheckedVariable = 'tos_checked_online';?><?php  if (isset($start_data_fields[$tosVariable]) && $start_data_fields[$tosVariable] == true) : $hasExtraField = true;?><div class="form-group<?php  if (isset($errors['accept_tos'])) : ?> has-error<?php  endif;?>"><label class="control-label"><input type="checkbox" <?php  echo $input_data->accept_tos == true || ((!isset($_POST) || empty($_POST)) && isset($start_data_fields[$tosCheckedVariable]) && $start_data_fields[$tosCheckedVariable] == true) ? 'checked="checked"' : '';?> name="AcceptTOS" value="on">&nbsp;I accept my personal data will be handled according to&nbsp;<a target="_blank" href="#">our terms and to the Law</a></label></div><?php  endif; ?><div class="btn-group" role="group" aria-label="..."><input type="submit" class="btn btn-primary btn-sm startchat" value="Start chat" name="StartChatAction" /><?php   ?><?php  if ( '1' == 1 && ($reopenData = erLhcoreClassChat::canReopenDirectly(array('reopen_closed' => '1'))) !== false ) : ?><input type="button" class="btn btn-default btn-sm resumechat"  value="Resume chat" onclick="document.location.replace('/zcodialawfirm/ztchat/index.php/chat/reopen/<?php  echo $reopenData['id']?>/<?php  echo $reopenData['hash']?><?php  if ( isset($modeAppend) && $modeAppend != '' ) : ?>/(embedmode)/embed<?php  endif;?>')"><?php  endif; ?></div><input type="hidden" value="<?php  echo htmlspecialchars($referer);?>" name="URLRefer"/><input type="hidden" value="<?php  echo htmlspecialchars($referer_site);?>" name="r" /><input type="hidden" value="<?php  echo htmlspecialchars($input_data->operator);?>" name="operator" /><input type="hidden" value="1" name="StartChat"/><?php  if ($leaveamessage == true && (int)'1' == 1) : ?><div id="offline-modal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog"  aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" id="myModalLabel">Department is offline</h4></div><div class="modal-body"><div class="btn-group" role="group" aria-label="..."><a href="#" class="btn btn-default btn-xs" title="Go to leave a message form" onclick="return lhinst.switchToOfflineForm();">Leave a message</a><a href="#" class="btn btn-default btn-xs" title="Cancel and choose another department" onclick="closeRevealForm();return $('#offline-modal').modal('hide');">Cancel</a></div></div></div></div></div><script>function closeRevealForm() {$('#id_DepartamentID').find('option').removeAttr('selected');$('#id_DepartamentID').find("[data-attr-online='true']").attr('selected','selected');};$('#id_DepartamentID').change(function() {if ( $(this).find('option:selected').attr('data-attr-online') == 'false' ) {$('#offline-modal').modal({'show':true,keyboard:false,backdrop: 'static'});};});$(document).ready(function() {if ( $('#id_DepartamentID').find('option:selected').attr('data-attr-online') == 'false' ) {$('#offline-modal').modal({'show':true,keyboard:false,backdrop: 'static'});};});</script><?php  endif;?></form><?php  else : ?><h4><?php  if (isset($theme) && $theme !== false && $theme->noonline_operators_offline) : ?><?php  echo htmlspecialchars($theme->noonline_operators_offline)?><?php  else : ?>There are no online operators at the moment, please leave your message<?php  endif;?></h4><?php  $chat_part_offline_form_start_chat_enabled = true;?><?php  if ($chat_part_offline_form_start_chat_enabled == true) : ?><?php  if (isset($request_send)) : $msg = 'Your request was sent!';?><div role="alert" class="alert alert-success alert-dismissible fade in"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><?php  echo $msg?></div><?php  else : ?><form enctype="multipart/form-data" class="fsc_off" method="post" id="form-start-chat" action="/zcodialawfirm/ztchat/index.php/chat/startchat/(offline)/true/(leaveamessage)/true<?php  $department !== false ? print '/(department)/'.$department : ''?><?php  $input_data->chatprefill !== '' ? print '/(chatprefill)/'.htmlspecialchars($input_data->chatprefill) : ''?><?php  echo $append_mode_theme?>" onsubmit="return lhinst.addCaptcha('<?php  echo time()?>',$(this))"><?php  if (isset($start_data_fields['offline_name_visible_in_popup']) && $start_data_fields['offline_name_visible_in_popup'] == true) : ?><?php  if (isset($start_data_fields['offline_name_hidden']) && $start_data_fields['offline_name_hidden'] == true) : ?><input type="hidden" name="Username" value="<?php  echo htmlspecialchars($input_data->username);?>" /><?php  else : ?><div class="form-group<?php  if (isset($errors['nick'])) : ?> has-error<?php  endif;?>"><label class="control-label">Name<?php  if (isset($start_data_fields['offline_name_require_option']) && $start_data_fields['offline_name_require_option'] == 'required') : ?>*<?php  endif;?></label><input class="form-control" type="text" name="Username" value="<?php  echo htmlspecialchars($input_data->username);?>" /></div><?php  endif; ?><?php  endif; ?><?php  if (isset($start_data_fields['offline_email_hidden']) && $start_data_fields['offline_email_hidden'] == true) : ?><input type="hidden" name="Email" value="<?php  echo htmlspecialchars($input_data->email);?>" /><?php  else : ?><div class="form-group<?php  if (isset($errors['email'])) : ?> has-error<?php  endif;?>"><label class="control-label">E-mail*</label><input class="form-control" type="text" name="Email" value="<?php  echo htmlspecialchars($input_data->email);?>" /></div><?php  endif;?><?php  if (isset($start_data_fields['offline_phone_visible_in_popup']) && $start_data_fields['offline_phone_visible_in_popup'] == true) : ?><?php  if (isset($start_data_fields['offline_phone_hidden']) && $start_data_fields['offline_phone_hidden'] == true) : ?><input type="hidden" name="Phone" value="<?php  echo htmlspecialchars($input_data->phone);?>" /><?php  else : ?><div class="form-group<?php  if (isset($errors['phone'])) : ?> has-error<?php  endif;?>"><label class="control-label">Phone<?php  if (isset($start_data_fields['offline_phone_require_option']) && $start_data_fields['offline_phone_require_option'] == 'required') : ?>*<?php  endif;?></label><input class="form-control" type="text" name="Phone" value="<?php  echo htmlspecialchars($input_data->phone);?>" /></div><?php  endif;?><?php  endif; ?><?php  if (isset($start_data_fields['offline_file_visible_in_popup']) && $start_data_fields['offline_file_visible_in_popup'] == true) : ?><div class="form-group"><label class="control-label">File</label><input type="file" name="File" value="" /></div><?php  endif; ?><?php  if (isset($start_data_fields['offline_message_visible_in_popup']) && $start_data_fields['offline_message_visible_in_popup'] == true) : ?><?php  if (isset($start_data_fields['offline_message_hidden']) && $start_data_fields['offline_message_hidden'] == true) : ?><textarea class="hide" placeholder="Enter your message" name="Question"><?php  echo htmlspecialchars($input_data->question);?></textarea><?php  else : ?><div class="form-group<?php  if (isset($errors['question'])) : ?> has-error<?php  endif;?>"><label class="control-label">Your question<?php  if (isset($start_data_fields['offline_message_require_option']) && $start_data_fields['offline_message_require_option'] == 'required') : ?>*<?php  endif;?></label><textarea class="form-control" placeholder="Enter your message" name="Question"><?php  echo htmlspecialchars($input_data->question);?></textarea></div><?php  endif;?><?php  endif;?><?php  $adminCustomFieldsMode = 'off';?><?php   if (isset($start_data_fields['custom_fields']) && $start_data_fields['custom_fields'] != '') : $customAdminfields = json_decode($start_data_fields['custom_fields'],true); if (is_array($customAdminfields)) : ?><div class="row"><?php  foreach ($customAdminfields as $key => $adminField) : if ($adminField['visibility'] == 'all' || $adminCustomFieldsMode == $adminField['visibility']) : ?><?php  if ($adminField['fieldtype'] == 'hidden' || (isset($input_data->via_hidden[$key]) && $input_data->via_hidden[$key] == 't')) : ?><?php  if (isset($input_data->via_hidden[$key]) && $input_data->via_hidden[$key] == 't') : ?><input class="form-control" type="hidden" name="via_hidden[<?php  echo $key?>]" value="t" /><?php  endif;?><?php  if (isset($input_data->via_encrypted[$key]) && $input_data->via_encrypted[$key] == 't') : ?><input class="form-control" type="hidden" name="via_encrypted[<?php  echo $key?>]" value="t" /><?php  endif;?><input class="form-control" type="hidden" name="value_items_admin[<?php  echo $key?>]" value="<?php  isset($input_data->value_items_admin[$key]) ? print htmlspecialchars($input_data->value_items_admin[$key]) : print htmlspecialchars($adminField['defaultvalue'])?>" /><?php  elseif ($adminField['fieldtype'] == 'dropdown') : ?><?php  if (!isset($adminField['showcondition']) || $adminField['showcondition'] == 'always' || ($adminField['showcondition'] == 'uempty' && ($input_data->username == '' || isset($_POST['show_admin_item'][$key])))) : ?><input type="hidden" name="show_admin_item[<?php  echo $key?>]" value="true" /><div class="col-xs-<?php  echo htmlspecialchars($adminField['size'])?>"><div class="form-group<?php  if (isset($errors['additional_admin_'.$key])) : ?> has-error<?php  endif;?>"><label class="control-label" id="label-<?php  echo htmlspecialchars('additional_admin_'.$key)?>"><?php  echo htmlspecialchars($adminField['fieldname'])?>&nbsp;<?php  $adminField['isrequired'] == 'true' ? print '*' : ''?></label><select name="value_items_admin[<?php  echo $key?>]" class="form-control"><option value="">Please choose</option><?php  foreach (explode("\n",$adminField['options']) as $option) : ?><option <?php  isset($input_data->value_items_admin[$key]) && $option == $input_data->value_items_admin[$key] ? print 'selected="selected"' : ''?> value="<?php  echo htmlspecialchars($option)?>"><?php  echo htmlspecialchars($option)?></option><?php  endforeach; ?></select></div></div><?php  endif; ?><?php  else : $hasExtraField = true; ?><?php  if (!isset($adminField['showcondition']) || $adminField['showcondition'] == 'always' || ($adminField['showcondition'] == 'uempty' && ($input_data->username == '' || isset($_POST['show_admin_item'][$key])))) : ?><input type="hidden" name="show_admin_item[<?php  echo $key?>]" value="true" /><div class="col-xs-<?php  echo htmlspecialchars($adminField['size'])?>"><div class="form-group<?php  if (isset($errors['additional_admin_'.$key])) : ?> has-error<?php  endif;?>"><label class="control-label" id="label-<?php  echo htmlspecialchars('additional_admin_'.$key)?>"><?php  echo htmlspecialchars($adminField['fieldname'])?>&nbsp;<?php  $adminField['isrequired'] == 'true' ? print '*' : ''?></label><input class="form-control" aria-labelledby="label-<?php  echo htmlspecialchars('additional_admin_'.$key)?>" type="text" name="value_items_admin[<?php  echo $key?>]" <?php  $adminField['isrequired'] == 'true' ? print 'aria-required="true" required' : ''?> value="<?php  isset($input_data->value_items_admin[$key]) ? print htmlspecialchars($input_data->value_items_admin[$key]) : print htmlspecialchars($adminField['defaultvalue'])?>" /></div></div><?php  endif; ?><?php  endif; endif; endforeach;?></div><?php  endif; endif;?><?php   $modeUserVariables = isset($modeUserVariables) ? $modeUserVariables : 'on'; if (!empty($input_data->name_items)) { $hasExtraField = true; }; foreach ($input_data->name_items as $item) : ?><input type="hidden" name="name_items[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;?><?php  if (isset($input_data->value_sizes)) : foreach ($input_data->value_sizes as $item) : ?><input type="hidden" name="value_sizes[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php  if (isset($input_data->values_req)) : foreach ($input_data->values_req as $item) : ?><input type="hidden" name="values_req[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php  if (isset($input_data->value_show)) : foreach ($input_data->value_show as $item) : ?><input type="hidden" name="value_show[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php  if (isset($input_data->hattr)) : foreach ($input_data->hattr as $item) : ?><input type="hidden" name="hattr[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php  if (isset($input_data->encattr)) : foreach ($input_data->encattr as $item) : ?><input type="hidden" name="encattr[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;endif;?><?php $hasVisibleField = false; foreach ($input_data->value_types as $key => $item) : $showField = ($input_data->value_show[$key] == $modeUserVariables || $input_data->value_show[$key] == 'b'); ($hasVisibleField = ($item == 'text' && $showField == true) ? true : $hasVisibleField); ?><input type="hidden" name="value_types[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  endforeach;?><?php  if ($hasVisibleField == true) : ?><div class="row"><?php  endif;?><?php  foreach ($input_data->value_items as $key => $item) : $showField = ($input_data->value_show[$key] == $modeUserVariables || $input_data->value_show[$key] == 'b'); $visibleItem = (isset($input_data->value_types[$key]) && $input_data->value_types[$key] == 'text' && isset($input_data->name_items[$key])); ?><?php  if ($visibleItem == true && $showField == true) : ?><div class="form-group col-xs-<?php  isset($input_data->value_sizes[$key]) ? print (int)$input_data->value_sizes[$key] : print 6?><?php  if (isset($errors['additional_'.$key])) : ?> has-error<?php  endif;?>"><label class="control-label"><?php  echo htmlspecialchars($input_data->name_items[$key])?><?php  isset($input_data->values_req[$key]) && $input_data->values_req[$key] == 't' ? print '*' : ''?></label><?php  endif;?><input class="form-control" type="<?php  isset($input_data->value_types[$key]) && $showField == true ? print htmlspecialchars($input_data->value_types[$key]) : print 'hidden' ?>" name="value_items[]" value="<?php  echo htmlspecialchars($item)?>" /><?php  if ($visibleItem == true && $showField == true) : ?></div><?php  endif;?><?php  endforeach;?><?php  if ($hasVisibleField == true) : ?></div><?php  endif;?><?php  if ($department === false) : ?><?php if ('0' == 1) { $filter = array('sort' => 'priority ASC, name ASC'); if (isset($input_data->product_id_array) && !empty($input_data->product_id_array)) { $filter['filterin']['id'] = $input_data->product_id_array; } if (isset($input_data->departament_id_array) && !empty($input_data->departament_id_array)) { $filter['filterin']['departament_id'] = $input_data->departament_id_array; } if ($input_data->departament_id > 0) { $filter['filterin']['departament_id'][] = $input_data->departament_id; } $filter['filter']['disabled'] = 0; if ('0' == 0) { $products = erLhAbstractModelProduct::getList($filter); if (!empty($products)) { $departmentsOptions['hide_department'] = true; } } elseif ('0' == 1) { ?><script>$(document).ready(function() {function updateProducts(dep_id) {$.getJSON("/zcodialawfirm/ztchat/index.php/product/getproducts/" + dep_id + "/<?php  echo $input_data->product_id?>", function(data) {$('#ProductContainer').html(data.result);});};$('#id_DepartamentID').change(function() {updateProducts($(this).val());});updateProducts($('#id_DepartamentID').find('option:selected').val());});</script><?php  } } $filter = array('filter' => array('disabled' => 0, 'hidden' => 0)); if (isset($input_data->departament_id_array)) { $filter['filterin']['id'] = $input_data->departament_id_array; } $filter['sort'] = 'sort_priority ASC, name ASC'; $departments = erLhcoreClassModelDepartament::getList($filter); if (count($departments) > 1) : $hasExtraField = true;?><?php  if (isset($input_data->departament_id_array)) : foreach ($input_data->departament_id_array as $definedDep) : ?><input type="hidden" name="DepartmentIDDefined[]" value="<?php  echo $definedDep?>" /><?php  endforeach; endif; ?><?php  if (!isset($departmentsOptions['hide_department']) || $departmentsOptions['hide_department'] == false) : ?><div class="form-group<?php  if (isset($errors['department'])) : ?> has-error<?php  endif;?>"><label class="control-label" id="label-department"><?php  if (isset($theme) && $theme !== false && $theme->department_title != '') : ?><?php  echo htmlspecialchars($theme->department_title)?><?php  else : ?>Department<?php  endif;?></label><select aria-labelledby="label-department" class="form-control" name="DepartamentID" id="id_DepartamentID"><?php  if (isset($theme) && $theme !== false && $theme->department_select != '') : ?><option value="-1"><?php  echo htmlspecialchars($theme->department_select)?></option><?php  endif;?><?php  $departments = erLhcoreClassDepartament::sortByStatus($departments); foreach ($departments as $departament) : $isOnline = erLhcoreClassChat::isOnline($departament->id,false,array('ignore_user_status'=> (int)'0', 'online_timeout' => (int)'300')); ?><?php  if (($departament->visible_if_online == 1 && $isOnline === true) || $departament->visible_if_online == 0) : ?><option data-attr-online="<?php  if ($isOnline === false) : ?>false<?php  else : ?>true<?php  endif;?>" <?php  if ($isOnline === false) : ?>class="offline-dep"<?php  endif;?> value="<?php  echo $departament->id?>" <?php  isset($input_data->departament_id) && $input_data->departament_id == $departament->id ? print 'selected="selected"' : '';?> ><?php  echo htmlspecialchars($departament->name)?><?php  if ($isOnline === false) : ?>&nbsp;&nbsp;--=Offline=--<?php  endif;?></option><?php  endif;?><?php  endforeach; ?></select></div><?php  endif; endif; ?><?php  endif;?><?php  $tosVariable = 'offline_tos_visible_in_popup';$tosCheckedVariable = 'tos_checked_offline';?><?php  if (isset($start_data_fields[$tosVariable]) && $start_data_fields[$tosVariable] == true) : $hasExtraField = true;?><div class="form-group<?php  if (isset($errors['accept_tos'])) : ?> has-error<?php  endif;?>"><label class="control-label"><input type="checkbox" <?php  echo $input_data->accept_tos == true || ((!isset($_POST) || empty($_POST)) && isset($start_data_fields[$tosCheckedVariable]) && $start_data_fields[$tosCheckedVariable] == true) ? 'checked="checked"' : '';?> name="AcceptTOS" value="on">&nbsp;I accept my personal data will be handled according to&nbsp;<a target="_blank" href="#">our terms and to the Law</a></label></div><?php  endif; ?><div class="btn-group" role="group" aria-label="..."><input type="submit" class="btn btn-default leaveamessage" value="Leave a message" name="StartChatAction" /><?php   ?><?php  if ( '1' == 1 && ($reopenData = erLhcoreClassChat::canReopenDirectly(array('reopen_closed' => '1'))) !== false ) : ?><input type="button" class="btn btn-default resumechat"  value="Resume chat" onclick="document.location.replace('/zcodialawfirm/ztchat/index.php/chat/reopen/<?php  echo $reopenData['id']?>/<?php  echo $reopenData['hash']?><?php  if ( isset($modeAppend) && $modeAppend != '' ) : ?>/(embedmode)/embed<?php  endif;?>')"><?php  endif; ?></div><input type="hidden" value="<?php  echo htmlspecialchars($referer);?>" name="URLRefer"/><input type="hidden" value="1" name="StartChat"/></form><?php  endif;?><?php  else : ?><?php   $errors = array('Offline form is disabled'); ?><?php  if (isset($errors)) : ?><div data-alert class="alert alert-danger alert-dismissible fade in"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><ul class="validation-ul"><?php  foreach ($errors as $err) : ?><li><?php  echo $err?></li><?php  endforeach;?></ul></div><?php  endif;?><?php  endif;?><?php  endif;?><?php  endif;?><?php  endif;?>