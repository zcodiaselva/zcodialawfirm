<div class="row"><div class="col-sm-7 chat-main-left-column" id="chat-main-column-<?php  echo $chat->id;?>"><span class="last-user-msg" title="Last visitor message time"><i class="material-icons">access_time</i><span id="last-msg-chat-<?php  echo $chat->id?>">...</span></span><a title="Show/Hide right column" href="#" class="material-icons collapse-right" onclick="lhinst.processCollapse('<?php  echo $chat->id;?>')">chevron_right</a><?php   ?><div class="message-block"><?php  $LastMessageID = 0; $messages = erLhcoreClassChat::getChatMessages($chat->id, erLhcoreClassChat::$limitMessages); ?><a class="load-prev-btn" data-initial="1" id="load-prev-btn-<?php  echo $chat->id?>" title="Load more..." onclick="return lhinst.loadPreviousMessages($(this))"><i class="material-icons">&#xE889;</i></a><div class="msgBlock msgBlock-admin" id="messagesBlock-<?php  echo $chat->id?>"><?php  if ($chat->status != erLhcoreClassModelChat::STATUS_CHATBOX_CHAT) : $lastOperatorChanged = false; $lastOperatorId = false; foreach ($messages as $msg) : if ($lastOperatorId !== false && $lastOperatorId != $msg['user_id']) { $lastOperatorChanged = true; } else { $lastOperatorChanged = false; } $lastOperatorId = $msg['user_id']; if ($msg['user_id'] == -1) : ?><div class="message-row system-response" id="msg-<?php  echo $msg['id']?>" title="<?php  echo erLhcoreClassChat::formatDate($msg['time']);?>"><div class="msg-date"><?php  echo erLhcoreClassChat::formatDate($msg['time']);?></div><i><span class="usr-tit sys-tit">System assistant</span><div class="msg-body"><?php  echo erLhcoreClassBBCode::make_clickable(htmlspecialchars($msg['msg']))?></div></i></div><?php  else : ?><div class="message-row<?php  echo $msg['user_id'] == 0 ? ' response' : ' message-admin'.($lastOperatorChanged == true ? ' operator-changes' : '') ?>" data-op-id="<?php  echo $msg['user_id']?>" title="<?php  echo erLhcoreClassChat::formatDate($msg['time']);?>" id="msg-<?php  echo $msg['id']?>"><div class="msg-date"><?php  echo erLhcoreClassChat::formatDate($msg['time']);?></div><span class="usr-tit<?php  echo $msg['user_id'] == 0 ? ' vis-tit' : ' op-tit'?>"><?php  echo $msg['user_id'] == 0 ? '<i class="material-icons chat-operators mi-fs15 mr-0">'.($chat->device_type == 0 ? '&#xE30A;' : ($chat->device_type == 1 ? '&#xE32C;' : '&#xE32F;')).'</i> '.htmlspecialchars($chat->nick) : '<i class="material-icons chat-operators mi-fs15 mr-0">&#xE851;</i>'.htmlspecialchars($msg['name_support']) ?></span><div class="msg-body"><?php  echo erLhcoreClassBBCode::make_clickable(htmlspecialchars($msg['msg']))?></div></div><?php  endif;?><?php  endforeach; ?><?php  else : ?><?php  foreach ($messages as $msg ) : ?><div class="message-row<?php  echo $msg['user_id'] == 0 ? ' response' : ' message-admin'?>" id="msg-<?php  echo $msg['id']?>" title="<?php  echo erLhcoreClassChat::formatDate($msg['time']);?>"><div class="msg-date"><?php  echo erLhcoreClassChat::formatDate($msg['time']);?></div><span class="usr-tit<?php  echo $msg['user_id'] == 0 ? ' vis-tit' : ' op-tit'?>"><?php  echo $msg['user_id'] == 0 ? htmlspecialchars($msg['name_support']) : htmlspecialchars($chat->nick) ?></span><div class="msg-body"><?php  echo erLhcoreClassBBCode::make_clickable(htmlspecialchars($msg['msg']))?></div></div><?php  endforeach; ?><?php  endif;?><?php  if (isset($msg)) { $LastMessageID = $msg['id'];} ?><?php  if ($chat->user_status == 1) : ?><div class="message-row system-response"><i><span class="usr-tit sys-tit">System assistant</span>Visitor has left the chat!</i></div><?php  elseif ($chat->user_status == 0) : ?><div class="message-row system-response"><i><span class="usr-tit sys-tit">System assistant</span>Visitor has joined the chat!</i></div><?php  endif;?></div></div><div class="user-is-typing" id="user-is-typing-<?php  echo $chat->id?>">User is typing now...</div><div class="message-container-admin"><textarea <?php  !erLhcoreClassChat::hasAccessToWrite($chat) ? print 'readonly="readonly"' : '' ?> placeholder="<?php  if ($chat->user_id != erLhcoreClassUser::instance()->getUserID()) : ?>You are not chat owner, type with caution<?php  endif;?>" class="form-control form-group<?php  if ($chat->user_id != erLhcoreClassUser::instance()->getUserID()) : ?> form-control-warning<?php  endif;?>" rows="2" <?php  if ($chat->status == erLhcoreClassModelChat::STATUS_CLOSED_CHAT) : ?>readonly="readonly"<?php  endif;?> name="ChatMessage" id="CSChatMessage-<?php  echo $chat->id?>"></textarea></div><?php   ?><div class="form-group"><?php  if ($canEditChat == true) : ?><div class="form-group" id="action-block-row-<?php  echo $chat->id?>"><div class="send-row<?php  if ($chat->status == erLhcoreClassModelChat::STATUS_CLOSED_CHAT) : ?> hide<?php  endif;?>"><div class="btn-group btn-group-justified"><a href="#" class="btn btn-default material-icons" onclick="return lhinst.addmsgadmin('<?php  echo $chat->id?>')" title="Send">&#xE163;</a><?php  $speech_action_enabled = true;?><?php  if ($speech_action_enabled == true && erLhcoreClassUser::instance()->hasAccessTo('lhspeech','use')) : ?><a class="btn btn-default" href="#" id="mic-chat-<?php  echo $chat->id?>" onclick="return lhc.methodCall('lhc.speak','listen',{'chat_id':'<?php  echo $chat->id?>'})"><i class="material-icons">mic_none</i><span class="mic-lang"></span></a><?php  endif;?><?php  $translation_action_enabled = true;?><?php  if ($translation_action_enabled == true && erLhcoreClassUser::instance()->hasAccessTo('lhtranslation','use')) : ?><?php  $dataChatTranslation = !isset($dataChatTranslation) ? array (0 => false,'translation_handler' => 'bing','enable_translations' => false,'bing_client_id' => '','bing_client_secret' => '','google_api_key' => '',) : $dataChatTranslation; ?><?php  if ($dataChatTranslation['enable_translations'] && $dataChatTranslation['enable_translations'] == true) : ?><a class="btn btn-default translate-button-<?php  echo $chat->id?><?php  if ($chat->chat_locale != '' && $chat->chat_locale_to != '') :?> btn-success<?php  endif;?> material-icons" title="Auto translate" id="start-trans-btn-<?php  echo $chat->id?>" onclick="return lhc.methodCall('lhc.translation','startTranslation',{'btn':$(this),'chat_id':'<?php  echo $chat->id?>'})">language</a><?php  endif;?><?php  endif;?><?php  $chat_part_canned_messages_action_enabled = true;?><?php  if ($chat_part_canned_messages_action_enabled == true) : ?><a title="Send delayed canned message instantly" href="#" class="btn btn-default material-icons" onclick="return lhinst.sendCannedMessage('<?php  echo $chat->id?>',$(this))">mail</a><?php  endif;?><a title="Hold/Un-Hold chat" href="#" class="btn btn-default material-icons<?php  ($chat->status_sub == erLhcoreClassModelChat::STATUS_SUB_ON_HOLD) ? print ' btn-info' : ''?>" id="hold-action-<?php  echo $chat->id?>" onclick="return lhinst.holdAction('<?php  echo $chat->id?>',$(this))">pan_tool</a><a title="BB Code" href="#" class="btn btn-default material-icons" onclick="return lhc.revealModal({'url':'/zcodialawfirm/ztchat/index.php/site_admin/chat/bbcodeinsert/<?php  echo $chat->id?>'})">&#xE24E;</a></div></div><?php  if ($chat->status == erLhcoreClassModelChat::STATUS_CLOSED_CHAT) : ?><input type="button" value="Reopen chat" class="btn btn-default" data-id="<?php  echo $chat->id?>" onclick="lhinst.reopenchat($(this))" /><?php  endif;?></div><?php  $chat_part_canned_messages_action_enabled = true;?><?php  if ($chat_part_canned_messages_action_enabled == true) : ?><div class="row"><div class="col-xs-8"><select class="form-control" name="CannedMessage-<?php  echo $chat->id?>" id="id_CannedMessage-<?php  echo $chat->id?>"><?php  $canned_options = erLhcoreClassModelCannedMsg::groupItems(erLhcoreClassModelCannedMsg::getCannedMessages($chat->dep_id, erLhcoreClassUser::instance()->getUserID()), $chat, erLhcoreClassUser::instance()->getUserData(true)); ?><option value="">Select a canned message</option><?php   foreach ($canned_options as $depId => $group) : $dataList = explode('_', $depId); $typeTitle = ''; if ($dataList[0] == 0) { $typeTitle = htmlspecialchars(erLhcoreClassModelDepartament::fetch($dataList[1])); } elseif ($dataList[0] == 1) { $typeTitle = 'Personal'; } else { $typeTitle = 'Global'; } ?><optgroup label="<?php  echo $typeTitle ?>"><?php  foreach ($group as $item) : ?><option data-msg="<?php  echo htmlspecialchars($item->msg_to_user)?>" data-delay="<?php  echo $item->delay?>" value="<?php  echo $item->id?>"><?php  echo htmlspecialchars($item->message_title)?></option><?php  endforeach; ?></optgroup><?php  endforeach; ?></select></div><div class="col-xs-3"><input type="text" class="form-control" id="id_CannedMessageSearch-<?php  echo $chat->id?>" value="" placeholder="Type to search"/></div><div class="col-xs-1 sub-action-chat" id="sub-action-chat-<?php  echo $chat->id?>"><a title="Fill textarea with canned message" href="#" onclick="$('#CSChatMessage-<?php  echo $chat->id?>').val(($('#id_CannedMessage-<?php  echo $chat->id?>').val() > 0) ? $('#id_CannedMessage-<?php  echo $chat->id?>').find(':selected').attr('data-msg') : '');return false;" class="btn btn-default"><i class="material-icons mr-0">mode_edit</i></a></div></div><?php  endif;?><?php  endif; ?></div></div><div class="col-sm-5 chat-main-right-column" id="chat-right-column-<?php  echo $chat->id;?>"><div role="tabpanel"><ul class="nav nav-pills" role="tablist" id="chat-tab-items-<?php  echo $chat->id?>"><?php   $chatTabsOrder = array( 'information_tab_tab', 'chat_translation_tab', 'operator_remarks_tab', 'information_tab_user_files_tab', 'operator_screenshot_tab', 'footprint_tab_tab', 'map_tab_tab', 'online_user_info_tab', 'extension_chat_tab_multiinclude', ); $chatTabsOrderDefault = 'information_tab_tab'; ?><?php foreach ($chatTabsOrder as $tabItem) : ?><?php  if ($tabItem == 'information_tab_tab') : ?><li role="presentation"<?php  if ($chatTabsOrderDefault == 'information_tab_tab') print ' class="active"';?>><a href="#main-user-info-tab-<?php  echo $chat->id?>" aria-controls="main-user-info-tab-<?php  echo $chat->id?>" role="tab" data-toggle="tab" title="Visitor"><i class="material-icons mr-0">info_outline</i></a></li><?php  elseif ($tabItem == 'chat_translation_tab') : ?><?php  $chat_translation_tab_enabled = true;?><?php  if ($chat_translation_tab_enabled == true && erLhcoreClassUser::instance()->hasAccessTo('lhtranslation','use')) : ?><?php  $dataChatTranslation = !isset($dataChatTranslation) ? array (0 => false,'translation_handler' => 'bing','enable_translations' => false,'bing_client_id' => '','bing_client_secret' => '','google_api_key' => '',) : $dataChatTranslation; ?><?php  if ($dataChatTranslation['enable_translations'] && $dataChatTranslation['enable_translations'] == true) : ?><li role="presentation"<?php  if ($chatTabsOrderDefault == 'chat_translation_tab') print ' class="active"';?>><a href="#main-user-info-translation-<?php  echo $chat->id?>" aria-controls="main-user-info-translation-<?php  echo $chat->id?>" title="Automatic translation" role="tab" data-toggle="tab"><i class="material-icons mr-0">language</i></a></li><?php  endif;?><?php  endif;?><?php  elseif ($tabItem == 'operator_remarks_tab') : ?><?php  $operator_remarks_tab_enabled = true;?><?php  if ($operator_remarks_tab_enabled == true) : ?><li role="presentation"<?php  if ($chatTabsOrderDefault == 'operator_remarks_tab') print ' class="active"';?>><a href="#main-user-info-remarks-<?php  echo $chat->id?>" aria-controls="main-user-info-remarks-<?php  echo $chat->id?>" role="tab" data-toggle="tab" title="Remarks"><i class="material-icons mr-0">mode_edit</i></a></li><?php  endif;?><?php  elseif ($tabItem == 'information_tab_user_files_tab') : ?><?php  $fileData = (array)erLhcoreClassModelChatConfig::fetch('file_configuration')->data?><?php  if ( isset($fileData['active_admin_upload']) && $fileData['active_admin_upload'] == true && erLhcoreClassUser::instance()->hasAccessTo('lhfile','use_operator') ) : ?><?php  $information_tab_user_files_tab_enabled = true;?><?php  if ($information_tab_user_files_tab_enabled == true) : ?><li role="presentation"<?php  if ($chatTabsOrderDefault == 'information_tab_user_files_tab') print ' class="active"';?>><a href="#main-user-info-files-<?php  echo $chat->id?>" aria-controls="main-user-info-files-<?php  echo $chat->id?>" title="Files" role="tab" data-toggle="tab"><i class="material-icons mr-0">attach_file</i></a></li><?php  endif;?><?php  endif; ?><?php  elseif ($tabItem == 'operator_screenshot_tab' && $canEditChat == true) : ?><?php  $operator_screenshot_tab_enabled = true;?><?php  if ($operator_screenshot_tab_enabled == true && erLhcoreClassUser::instance()->hasAccessTo('lhchat','take_screenshot')) : ?><li role="presentation"<?php  if ($chatTabsOrderDefault == 'operator_screenshot_tab') print ' class="active"';?>><a href="#main-user-info-screenshot-<?php  echo $chat->id?>" aria-controls="main-user-info-screenshot-<?php  echo $chat->id?>" title="Screenshot" role="tab" data-toggle="tab"><i class="material-icons mr-0">photo_camera</i></a></li><?php  endif;?><?php  elseif ($tabItem == 'footprint_tab_tab') : ?><?php  $chat_chat_tabs_footprint_tab_tab_enabled = true; ?><?php  if ($chat_chat_tabs_footprint_tab_tab_enabled == true && '0' == 1) : ?><li role="presentation"<?php  if ($chatTabsOrderDefault == 'footprint_tab_tab') print ' class="active"';?>><a href="#footprint-tab-chat-<?php  echo $chat->id?>" aria-controls="footprint-tab-chat-<?php  echo $chat->id?>" role="tab" data-toggle="tab" title="Footprint"><i class="material-icons mr-0">directions_walk</i></a></li><?php  endif;?><?php  elseif ($tabItem == 'map_tab_tab') : ?><?php  $information_tab_map_tab_tab_enabled = true;?><?php  if ($information_tab_map_tab_tab_enabled == true) : ?><li role="presentation"<?php  if ($chatTabsOrderDefault == 'map_tab_tab') print ' class="active"';?>><a href="#map-tab-chat-<?php  echo $chat->id?>" title="Map" aria-controls="map-tab-chat-<?php  echo $chat->id?>" role="tab" data-toggle="tab"><i class="material-icons mr-0">place</i></a></li><?php  endif;?><?php  elseif ($tabItem == 'online_user_info_tab') : ?><?php  if (($online_user = $chat->online_user) !== false) : ?><?php  $information_tab_online_user_info_tab_enabled = true;?><?php  if ($information_tab_online_user_info_tab_enabled == true) : ?><li role="presentation"<?php  if ($chatTabsOrderDefault == 'online_user_info_tab') print ' class="active"';?>><a href="#online-user-info-tab-<?php  echo $chat->id?>" aria-controls="online-user-info-tab-<?php  echo $chat->id?>" role="tab" data-toggle="tab" title="User browsing information"><i class="material-icons mr-0">face</i></a></li><?php  endif;?><?php  $information_tab_online_user_info_tab_chats_enabled = true?><?php  if ($information_tab_online_user_info_tab_chats_enabled == true) : ?><li role="presentation"><a href="#online-user-info-chats-tab-<?php  echo $chat->id?>" aria-controls="online-user-info-chats-tab-<?php  echo $chat->id?>" role="tab" data-toggle="tab" title="Chats"><i class="material-icons mr-0">chat</i></a></li><?php  endif;?><?php  else : ?><?php ?><?php  endif;?><?php  elseif ($tabItem == 'extension_chat_tab_multiinclude') : ?><?php   ?><?php  endif;?><?php  endforeach; ?></ul><div class="tab-content"><div role="tabpanel" class="tab-pane<?php  if ($chatTabsOrderDefault == 'information_tab_tab') print ' active';?>" id="main-user-info-tab-<?php  echo $chat->id?>"><?php   ?><div class="pull-right operator-info pt5"><i class="material-icons mr-0<?php  if ($chat->fbst == 1) : ?> up-voted<?php  endif;?>">thumb_up</i><i class="material-icons<?php  if ($chat->fbst == 2) : ?> down-voted<?php  endif;?>">thumb_down</i><i id="chat-id-<?php  echo $chat->id?>-mds" data-chat-status="<?php  echo $chat->status?>" data-chat-user="<?php  echo $chat->user_id?>" class="material-icons<?php  if ($chat->has_unread_op_messages == 1) : ?> chat-unread<?php  else : ?> chat-active<?php  endif;?>">chat</i><?php  if ($canEditChat == true && (!isset($hideActionBlock) || $hideActionBlock == false)) : ?><span class="pull-right <?php  if (erLhcoreClassUser::instance()->hasAccessTo('lhchat','canchangechatstatus')) : ?> action-image<?php  endif?>" id="chat-status-text-<?php  echo $chat->id?>" <?php  if (erLhcoreClassUser::instance()->hasAccessTo('lhchat','canchangechatstatus')) : ?>title="Click to change chat status" onclick="return lhc.revealModal({'url':WWW_DIR_JAVASCRIPT +'chat/changestatus/<?php  echo $chat->id?>'})"<?php  endif;?>><i class="material-icons mr-0" title="<?php  if ($chat->status == erLhcoreClassModelChat::STATUS_PENDING_CHAT) : ?>Pending chat<?php  elseif ($chat->status == erLhcoreClassModelChat::STATUS_ACTIVE_CHAT) : ?>Active chat<?php  elseif ($chat->status == erLhcoreClassModelChat::STATUS_CLOSED_CHAT) : ?>Closed chat<?php  elseif ($chat->status == erLhcoreClassModelChat::STATUS_CHATBOX_CHAT) : ?>Chatbox chat<?php  elseif ($chat->status == erLhcoreClassModelChat::STATUS_OPERATORS_CHAT) : ?>Operators chat<?php  endif;?>">info_outline</i></span><?php  endif; ?></div><div><?php   $orderChatButtons = array( array( 'item' => 'edit_chat', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'copy_messages', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'open_new_window', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'show_survey', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'remove_dialog_tab', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'close_chat', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'delete_chat', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'transfer', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'blockuser', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'send_mail', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'redirect_contact', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'print', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'attatch_file', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'redirect_user', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'speech', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'cobrowse', 'enabled' => !isset($hideActionBlock) ), array( 'item' => 'print_archive', 'enabled' => isset($hideActionBlock) ), array( 'item' => 'mail_archive', 'enabled' => isset($hideActionBlock) ) ); ?><?php  foreach ($orderChatButtons as $buttonData) : ?><?php  if ($buttonData['enabled'] == true) : ?><?php  if ($buttonData['item'] == 'edit_chat' && $canEditChat == true) : ?><a onclick="return lhc.revealModal({'title' : 'Modify chat', 'iframe':true,'height':350,'url':WWW_DIR_JAVASCRIPT +'chat/modifychat/<?php  echo $chat->id?>/(pos)/'+$('#chat-tab-li-<?php  echo $chat->id?>').index()})" title="Edit main chat information" href="#"><i class="material-icons mr-0">mode_edit</i></a><?php  elseif ($buttonData['item'] == 'open_new_window') : ?><a class="material-icons mr-0" data-title="<?php  echo htmlspecialchars($chat->nick,ENT_QUOTES);?>" onclick="lhinst.startChatCloseTabNewWindow('<?php  echo $chat->id;?>',$('#tabs'),$(this).attr('data-title'))" title="Open in a new window">open_in_new</a><?php  elseif ($buttonData['item'] == 'show_survey' && $canEditChat == true) : ?><a class="material-icons mr-0" onclick="lhc.revealModal({'url':WWW_DIR_JAVASCRIPT +'survey/choosesurvey/<?php  echo $chat->id?>'})" title="Redirect user to survey">speaker_notes</a><?php  elseif ($buttonData['item'] == 'remove_dialog_tab') : ?><?php  elseif ($buttonData['item'] == 'close_chat' && $canEditChat == true) : ?><?php  if ($chat->user_id == erLhcoreClassUser::instance()->getUserID() || erLhcoreClassUser::instance()->hasAccessTo('lhchat','allowcloseremote')) : ?><a class="material-icons mr-0" onclick="lhinst.closeActiveChatDialog(<?php  echo $chat->id?>,$('#tabs'),true)" title="Close chat">close</a><?php  endif;?><?php  elseif ($buttonData['item'] == 'delete_chat' && $canEditChat == true) : ?><?php  if (erLhcoreClassUser::instance()->hasAccessTo('lhchat','deleteglobalchat') || (erLhcoreClassUser::instance()->hasAccessTo('lhchat','deletechat') && $chat->user_id == erLhcoreClassUser::instance()->getUserID())) : ?><a class="material-icons mr-0" onclick="lhinst.deleteChat('<?php  echo $chat->id?>',$('#tabs'),true)" title="Delete chat">delete</a><?php  endif ?><?php  elseif ($buttonData['item'] == 'transfer' && $canEditChat == true) : ?><?php  $chat_chat_tabs_actions_transfer_enabled = true;?><?php  if ($chat_chat_tabs_actions_transfer_enabled == true && erLhcoreClassUser::instance()->hasAccessTo('lhchat', 'allowtransfer')) : ?><a class="material-icons mr-0" onclick="lhc.revealModal({'url':WWW_DIR_JAVASCRIPT +'chat/transferchat/<?php  echo $chat->id?>'})" title="Transfer chat">supervisor_account</a><?php  endif; ?><?php  elseif ($buttonData['item'] == 'blockuser' && $canEditChat == true) : ?><?php  if (erLhcoreClassUser::instance()->hasAccessTo('lhchat','allowblockusers')) : ?><?php  $chat_chat_tabs_actions_blockuser_enabled = true;?><?php  if ($chat_chat_tabs_actions_blockuser_enabled == true) : ?><a class="material-icons mr-0" data-title="Are you sure?" onclick="lhinst.blockUser('<?php  echo $chat->id?>',$(this).attr('data-title'))" title="Block user">block</a><?php  endif;?><?php  endif;?><?php  elseif ($buttonData['item'] == 'send_mail') : ?><a class="material-icons mr-0 <?php  if ($chat->mail_send == 1) : ?>icon-mail-send<?php  endif; ?>" onclick="lhc.revealModal({'iframe':true,'height':500,'url':WWW_DIR_JAVASCRIPT +'chat/sendmail/<?php  echo $chat->id?>'})" title="<?php  if ($chat->mail_send == 1) : ?>Mail was send<?php  else : ?>Send mail<?php  endif;?>">mail</a><?php  elseif ($buttonData['item'] == 'redirect_contact' && $canEditChat == true) : ?><a class="material-icons mr-0" title="Redirect user to contact form." onclick="lhinst.redirectContact('<?php  echo $chat->id;?>','Are you sure?')" >reply</a><?php  elseif ($buttonData['item'] == 'print') : ?><a target="_blank" href="/zcodialawfirm/ztchat/index.php/site_admin/chat/printchatadmin/<?php  echo $chat->id?>" class="material-icons mr-0" title="Print">print</a><?php  elseif ($buttonData['item'] == 'attatch_file' && $canEditChat == true) : ?><?php  $chat_chat_tabs_actions_attatch_file_enabled = true;?><?php  if ($chat_chat_tabs_actions_attatch_file_enabled == true) : ?><a class="material-icons mr-0" onclick="return lhc.revealModal({'iframe':true,'height':500,'url':WWW_DIR_JAVASCRIPT +'file/attatchfile/<?php  echo $chat->id?>'})" title="Attach uploaded file">attach_file</a><?php  endif;?><?php  elseif ($buttonData['item'] == 'redirect_user' && $canEditChat == true) : ?><?php  if (erLhcoreClassUser::instance()->hasAccessTo('lhchat','allowredirect')) : ?><a class="material-icons mr-0" onclick="lhinst.redirectToURL('<?php  echo $chat->id?>','Please enter a URL')" title="Redirect user to another url">link</a><?php  endif;?><?php  elseif ($buttonData['item'] == 'speech' && $canEditChat == true) : ?><?php  $chat_chat_tabs_actions_speech_enabled = true;?><?php  if ($chat_chat_tabs_actions_speech_enabled == true && erLhcoreClassUser::instance()->hasAccessTo('lhspeech','change_chat_recognition')) : ?><a class="material-icons mr-0" title="Choose other than default recognition language" onclick="lhc.revealModal({'url':'/zcodialawfirm/ztchat/index.php/site_admin/speech/setchatspeechlanguage/<?php  echo $chat->id?>'})">mic_none</a><?php  endif;?><?php  elseif ($buttonData['item'] == 'cobrowse' && $canEditChat == true) : ?><?php  $chat_chat_tabs_actions_cobrowse_enabled = true;?><?php  if ($chat_chat_tabs_actions_cobrowse_enabled == true && erLhcoreClassUser::instance()->hasAccessTo('lhcobrowse', 'browse')) : ?><a title="Screen sharing" class="material-icons" href="#" onclick="return lhinst.startCoBrowse('<?php  echo $chat->id?>')">visibility</a><?php  endif;?><?php  elseif ($buttonData['item'] == 'print_archive') : ?><a class="material-icons mr-0" target="_blank" href="/zcodialawfirm/ztchat/index.php/site_admin/chatarchive/printchatadmin/<?php  echo $archive->id?>/<?php  echo $chat->id?>">print</a><?php  elseif ($buttonData['item'] == 'mail_archive') : ?><a class="material-icons mr-0" onclick="return lhc.revealModal({'iframe':true,'height':500,'url':WWW_DIR_JAVASCRIPT +'chatarchive/sendmail/<?php  echo $archive->id?>/<?php  echo $chat->id?>'})">mail</a><?php  elseif ($buttonData['item'] == 'copy_messages') : ?><a class="material-icons" onclick="lhc.revealModal({'url':WWW_DIR_JAVASCRIPT +'chat/copymessages/<?php  echo $chat->id?>'})" title="Copy messages to clipboard">&#xE14D;</a><?php  endif; ?><?php  endif; ?><?php  endforeach; ?><?php   ?></div><?php $orderInformation = array( array( 'item' => 'department', 'enabled' => true ), array( 'item' => 'subject', 'enabled' => true ), array( 'item' => 'product', 'enabled' => true ), array( 'item' => 'uagent', 'enabled' => true ), array( 'item' => 'country_code', 'enabled' => true ), array( 'item' => 'user_tz_identifier', 'enabled' => true ), array( 'item' => 'city', 'enabled' => true ), array( 'item' => 'ip', 'enabled' => true ), array( 'item' => 'referrer', 'enabled' => true ), array( 'item' => 'session_referrer', 'enabled' => true ), array( 'item' => 'id', 'enabled' => true ), array( 'item' => 'email', 'enabled' => true ), array( 'item' => 'phone', 'enabled' => true ), array( 'item' => 'additional_data', 'enabled' => true ), array( 'item' => 'created', 'enabled' => true ), array( 'item' => 'user_left', 'enabled' => true ), array( 'item' => 'wait_time', 'enabled' => true ), array( 'item' => 'chat_duration', 'enabled' => true ), array( 'item' => 'chat_status', 'enabled' => true ), array( 'item' => 'chat_owner', 'enabled' => true ) ); ?><?php ?><table class="table table-condensed"><?php  foreach ($orderInformation as $buttonData) : ?><?php  if ($buttonData['enabled'] == true) : ?><?php  if ($buttonData['item'] == 'department') : ?><?php   ?><?php  if ( $chat->department !== false ) : ?><tr><td>Department</td><td><?php  if ($chat->status_sub == erLhcoreClassModelChat::STATUS_SUB_OFFLINE_REQUEST) : ?><i title="This is offline message" class="material-icons">mail</i><?php  endif?><?php  echo htmlspecialchars($chat->department);?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'product') : ?><?php  if ($chat->product !== false) : ?><tr><td>Product</td><td><?php  echo htmlspecialchars($chat->product);?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'uagent') : ?><?php  if ( !empty($chat->uagent) ) : ?><tr><td>Device</td><td><i class="material-icons" title="<?php  echo htmlspecialchars($chat->uagent)?>"><?php  echo ($chat->device_type == 0 ? 'computer' : ($chat->device_type == 1 ? 'smartphone' : 'tablet')) ?></i><?php  echo ($chat->device_type == 0 ? 'Computer' : ($chat->device_type == 1 ? 'Smartphone' : 'Tablet')) ?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'subject') : ?><tr><td>Subject</td><td><?php  $subjectsChat = erLhAbstractModelSubjectChat::getList(array('filter' => array('chat_id' => $chat->id))); foreach ($subjectsChat as $subject) : ?><a class="btn btn-xs btn-info"><?php  echo htmlspecialchars($subject)?></a>&nbsp;<?php  endforeach; ?><a class="btn btn-xs btn-success" onclick="return lhc.revealModal({'url':'/zcodialawfirm/ztchat/index.php/site_admin/chat/subject/<?php  echo $chat->id?>'})"><i class="material-icons mr-0">&#xE145;</i></a></td></tr><?php  elseif ($buttonData['item'] == 'country_code') : ?><?php  if ( !empty($chat->country_code) ) : ?><tr><td>Country</td><td><img src="/zcodialawfirm/ztchat/design/defaulttheme/images/flags/<?php  echo $chat->country_code?>.png" alt="<?php  echo htmlspecialchars($chat->country_name)?>" title="<?php  echo htmlspecialchars($chat->country_name)?>" />&nbsp;<?php  echo htmlspecialchars($chat->chat_locale)?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'user_tz_identifier') : ?><?php  if ( !empty($chat->user_tz_identifier) ) : ?><tr><td>Time zone</td><td><?php  echo htmlspecialchars($chat->user_tz_identifier)?>, <?php  echo htmlspecialchars($chat->user_tz_identifier_time)?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'city') : ?><?php  if ( !empty($chat->city) ) : ?><tr><td>City</td><td><?php  echo htmlspecialchars($chat->city);?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'ip') : ?><tr><td>IP</td><td><?php  echo htmlspecialchars($chat->ip)?></td></tr><?php  elseif ($buttonData['item'] == 'referrer') : ?><?php  if (!empty($chat->referrer)) : ?><tr><td>Page</td><td><div class="page-url"><span><?php  echo $chat->referrer != '' ? '<a target="_blank" rel="noopener" title="' . htmlspecialchars($chat->referrer) . '" href="' .htmlspecialchars($chat->referrer). '">'.htmlspecialchars($chat->referrer).'</a>' : ''?></span></div></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'session_referrer') : ?><?php  if (!empty($chat->session_referrer)) : ?><tr><td>Came from</td><td><div class="page-url"><span><?php  echo $chat->session_referrer != '' ? '<a target="_blank" rel="noopener" title="' . htmlspecialchars($chat->session_referrer) . '" href="' . htmlspecialchars($chat->session_referrer) . '">'.htmlspecialchars($chat->session_referrer).'</a>' : ''?></span></div></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'id') : ?><tr><td>ID</td><td><?php  echo $chat->id;?></td></tr><?php  elseif ($buttonData['item'] == 'email') : ?><?php  if (!empty($chat->email)) : ?><tr><td>E-mail</td><td><a href="mailto:<?php  echo $chat->email?>"><?php  echo $chat->email?></a></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'phone') : ?><?php  if (!empty($chat->phone)) : ?><tr><td>Phone</td><td><?php  echo htmlspecialchars($chat->phone)?></td></tr><?php  endif;?><?php   ?><?php  elseif ($buttonData['item'] == 'additional_data') : ?><?php  if (!empty($chat->additional_data)) : ?><tr><td><a class="btn btn-default btn-xs" onclick="lhinst.addRemoteCommand('<?php  echo $chat->id?>','lhc_cfrefresh');$('#custom-data-td-<?php  echo $chat->id?>').text('...')" title="Refresh"><i class="material-icons mr-0">&#xE5D5;</i></a>&nbsp;Additional data</td><td id="custom-data-td-<?php  echo $chat->id?>"><?php  if (is_array($chat->additional_data_array)) : ?><ul class="circle mb0"><?php  foreach ($chat->additional_data_array as $addItem) : ?><li><?php  echo htmlspecialchars($addItem->key)?> - <?php  echo htmlspecialchars($addItem->value)?><?php  if (isset($addItem->h) && $addItem->h == true) : ?>&nbsp;<i class="material-icons" title="Hidden field">visibility_off</i><?php  endif;?></li><?php  endforeach;?></ul><?php  else : ?><?php  echo htmlspecialchars($chat->additional_data)?><?php  endif;?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'created') : ?><tr><td colspan="2">Created at - <?php  echo $chat->time_created_front?><?php  if ($chat->pnd_time != $chat->time && $chat->pnd_time > 0) : ?>, Started at - <?php  echo $chat->pnd_time_front?><?php  endif; ?><?php  if ($chat->cls_time > 0 && $chat->status == erLhcoreClassModelChat::STATUS_CLOSED_CHAT) : ?>, Closed at - <?php  echo $chat->cls_time_front?><?php  endif;?></td></tr><?php  elseif ($buttonData['item'] == 'user_left') : ?><?php  if ($chat->user_closed_ts > 0 && $chat->user_status == 1) : ?><tr><td>User left</td><td><?php  echo $chat->user_closed_ts_front?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'wait_time') : ?><?php  if ($chat->wait_time > 0) : ?><tr><td>Waited</td><td><?php  echo $chat->wait_time_front?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'chat_duration') : ?><tr><td>Chat duration</td><td id="chat-duration-<?php  echo $chat->id?>"><?php  echo $chat->chat_duration_front?></td></tr><?php  elseif ($buttonData['item'] == 'chat_status') : ?><?php  if ($chat->status == erLhcoreClassModelChat::STATUS_OPERATORS_CHAT) : ?><tr><td>Chat between operators, chat initializer</td><td><?php  echo htmlspecialchars($chat->nick)?></td></tr><?php  endif;?><?php  elseif ($buttonData['item'] == 'chat_owner') : ?><tr><td>Chat owner</td><td><?php  $user = $chat->getChatOwner(); if ($user !== false) : ?><?php  echo htmlspecialchars($user->name.' '.$user->surname)?><?php  endif; ?></td></tr><?php  else : ?><?php ?><?php  endif;?><?php  endif; ?><?php  endforeach; ?></table></div><div role="tabpanel" class="tab-pane<?php  if ($chatTabsOrderDefault == 'operator_remarks_tab') print ' active';?>" id="main-user-info-remarks-<?php  echo $chat->id?>"><?php  $operator_remarks_enabled = true;?><?php  if ($operator_remarks_enabled == true) : ?><div id="remarks-status-<?php  echo $chat->id?>" class="material-icons pb10 success-color">mode_edit</div><div><textarea class="form-control mh150" <?php  if (!isset($hideActionBlock) && $canEditChat == true) : ?>onkeyup="lhinst.saveRemarks('<?php  echo $chat->id?>')"<?php  else : ?>readonly<?php  endif;?> id="ChatRemarks-<?php  echo $chat->id?>"><?php  echo htmlspecialchars($chat->remarks)?></textarea></div><?php  endif;?></div><?php  if ( isset($fileData['active_admin_upload']) && $fileData['active_admin_upload'] == true && erLhcoreClassUser::instance()->hasAccessTo('lhfile','use_operator') ) : ?><div role="tabpanel" class="tab-pane<?php  if ($chatTabsOrderDefault == 'information_tab_user_files_tab') print ' active';?>" id="main-user-info-files-<?php  echo $chat->id?>"><div><input type="button" value="Refresh" class="btn btn-default" onclick="lhinst.updateChatFiles('<?php  echo $chat->id?>')" /><ul id="chat-files-list-<?php  echo $chat->id?>"><?php  foreach (erLhcoreClassChat::getList(array('filter' => array('chat_id' => $chat->id)),'erLhcoreClassModelChatFile','lh_chat_file') as $file) : ?><li id="file-id-<?php  echo $file->id?>"><a title="Delete file" onclick="return lhinst.deleteChatfile('<?php  echo $file->id?>')" class="material-icons">delete</a><a href="/zcodialawfirm/ztchat/index.php/site_admin/file/downloadfile/<?php  echo $file->id?>/<?php  echo $file->security_hash?>" class="link" target="_blank"><?php  if ($file->user_id == 0) : ?>Sent by Customer<?php  else : ?>Sent by Operator<?php  endif;?> - <?php  echo htmlspecialchars($file->upload_name).' ['.$file->extension.']'?></a></li><?php  endforeach;?></ul></div><div class="form-group"><input id="fileupload-<?php  echo $chat->id?>" class="fs12" type="file" name="files[]" multiple></div><div class="drop-zone form-group" id="drop-zone-<?php  echo $chat->id?>"><div class="drop-title">Drop your files here.</div></div><script>lhinst.addFileUpload({ft_msg:'Not an accepted file type',fs_msg:'Filesize is too big',chat_id:'<?php  echo $chat->id?>',fs:<?php  echo $fileData['fs_max']*1024?>,ft_op:/(\.|\/)(<?php  echo $fileData['ft_op']?>)$/i});</script></div><?php  endif; ?><?php  $chat_translation_enabled = true;?><?php  if ($chat_translation_enabled == true && erLhcoreClassUser::instance()->hasAccessTo('lhtranslation','use')) : ?><?php   if ($dataChatTranslation['enable_translations'] && $dataChatTranslation['enable_translations'] == true) : ?><div role="tabpanel" class="tab-pane<?php  if ($chatTabsOrderDefault == 'chat_translation_tab') print ' active';?>" id="main-user-info-translation-<?php  echo $chat->id?>"><div class="row"><div class="col-xs-6"><div class="form-group"><label>Visitor language</label><?php  echo erLhcoreClassRenderHelper::renderCombobox( array ( 'input_name' => 'chat_locale_'.$chat->id, 'optional_field' => 'Automatically detected', 'selected_id' => $chat->chat_locale, 'css_class' => 'form-control', 'list_function' => 'erLhcoreClassTranslate::getSupportedLanguages' )); ?></div></div><div class="col-xs-6"><div class="form-group"><label>My language</label><?php  echo erLhcoreClassRenderHelper::renderCombobox( array ( 'input_name' => 'chat_locale_to_'.$chat->id, 'optional_field' => 'Automatically detected', 'selected_id' => $chat->chat_locale_to, 'css_class' => 'form-control', 'list_function' => 'erLhcoreClassTranslate::getSupportedLanguages' )); ?></div></div></div><div class="btn-group form-group" role="group" aria-label="..."><input type="button" value="Auto translate" class="translate-button-<?php  echo $chat->id?> btn btn-default<?php  if ($chat->chat_locale != '' && $chat->chat_locale_to != '') :?> btn-success<?php  endif;?>" data-loading-text="Translating..." onclick="return lhc.methodCall('lhc.translation','startTranslation',{'btn':$(this),'chat_id':'<?php  echo $chat->id?>'})" /></div></div><?php  endif;?><?php  endif;?><?php  $operator_screenshot_enabled = true ?><?php  if ($operator_screenshot_enabled == true && erLhcoreClassUser::instance()->hasAccessTo('lhchat','take_screenshot')) : ?><div role="tabpanel" class="tab-pane<?php  if ($chatTabsOrderDefault == 'operator_screenshot_tab') print ' active';?>" id="main-user-info-screenshot-<?php  echo $chat->id?>"><div class="btn-group" role="group" aria-label="..."><input type="button" value="Take user screenshot" class="btn btn-default" onclick="lhinst.addRemoteCommand('<?php  echo $chat->id?>','lhc_screenshot')" /><input type="button" value="Refresh" class="btn btn-default" onclick="lhinst.updateScreenshot('<?php  echo $chat->id?>')" /></div><div id="user-screenshot-container"><?php  if ($chat->screenshot !== false) : ?><h5>Taken <?php  echo $chat->screenshot->date_front?></h5><a href="/zcodialawfirm/ztchat/index.php/site_admin/file/downloadfile/<?php  echo $chat->screenshot->id?>/<?php  echo $chat->screenshot->security_hash?>/(inline)/true" target="_blank" class="screnshot-container"><img id="screenshotImage" src="/zcodialawfirm/ztchat/index.php/site_admin/file/downloadfile/<?php  echo $chat->screenshot->id?>/<?php  echo $chat->screenshot->security_hash?>" alt="" /></a><script>$(document).ready(function(){$('.screnshot-container').zoom();});</script><?php  else : ?><br/>Empty...<?php  endif;?></div></div><?php  endif;?><?php  $chat_chat_tabs_footprint_tab_enabled = true; ?><?php  if ($chat_chat_tabs_footprint_tab_enabled == true && '0' == 1) : ?><div role="tabpanel" class="tab-pane<?php  if ($chatTabsOrderDefault == 'footprint_tab_tab') print ' active';?>" id="footprint-tab-chat-<?php  echo $chat->id?>"><div class="mx170"><a class="btn btn-default btn-xs" rel="<?php  echo $chat->id?>" onclick="lhinst.refreshFootPrint($(this))">Refresh</a><ul class="foot-print-content circle" id="footprint-<?php  echo $chat->id?>"><?php $filter = $chat->online_user_id == 0 ? array('chat_id' => $chat->id) : array('online_user_id' => $chat->online_user_id); foreach (erLhcoreClassModelChatOnlineUserFootprint::getList(array('filter' => $filter)) as $footprintItems) : ?><li><a target="_blank" href="<?php  echo htmlspecialchars($footprintItems->page);?>"><?php  echo $footprintItems->time_ago?> | <?php  echo htmlspecialchars($footprintItems->page);?></a></li><?php  endforeach;?></ul></div></div><?php  endif;?><?php  $information_tab_map_tab_enabled = true;?><?php  if ($information_tab_map_tab_enabled == true) : ?><div role="tabpanel" class="tab-pane<?php  if ($chatTabsOrderDefault == 'map_tab_tab') print ' active';?>" id="map-tab-chat-<?php  echo $chat->id?>"><?php  if ($chat->lat != 0 && $chat->lon) : ?><a target="_blank" href="//maps.google.com/maps?t=h&q=<?php  echo $chat->lat?>,<?php  echo $chat->lon?>&z=17&hl=en&z=11&t=m"><img src="//maps.google.com/maps/api/staticmap?zoom=13&size=400x300&maptype=roadmap&center=<?php  echo $chat->lat?>,<?php  echo $chat->lon?>&sensor=false&markers=color:green|<?php  echo $chat->lat?>,<?php  echo $chat->lon?>" alt="" title="<?php  echo $chat->lat?>,<?php  echo $chat->lon?>" /></a>
<?php  else : ?><p>Could not detect. Make sure that GEO detection is enabled.</p><?php  endif;?></div><?php  endif;?><?php  if (($online_user = $chat->online_user) !== false) : ?><?php  $information_tab_online_user_info_enabled = true;?><?php  if ($information_tab_online_user_info_enabled == true) : ?><div role="tabpanel" class="tab-pane<?php  if ($chatTabsOrderDefault == 'online_user_info_tab') print ' active';?>" id="online-user-info-tab-<?php  echo $chat->id?>"><a class="btn btn-default btn-xs" rel="<?php  echo $chat->id?>" onclick="lhinst.refreshOnlineUserInfo($(this))">Refresh</a><div id="online-user-info-<?php  echo $chat->id?>"><div class="pull-right"><p class="fs12"><?php  if ( !empty($online_user->user_country_code) ) : ?><img src="/zcodialawfirm/ztchat/design/defaulttheme/images/flags/<?php  echo $online_user->user_country_code?>.png" alt="<?php  echo htmlspecialchars($online_user->user_country_name)?>" title="<?php  echo htmlspecialchars($online_user->user_country_name)?>" /><?php  endif; ?> (<?php  echo htmlspecialchars($online_user->ip)?>)<?php  if ( !empty($online_user->city) ) :?><br/>City: <?php  echo htmlspecialchars($online_user->city) ?><?php  endif;?><?php  if ( !empty($online_user->lat) ) :?><br/>Lat. <?php  echo htmlspecialchars($online_user->lat) ?><?php  endif;?><?php  if ( !empty($online_user->lon) ) :?><br/>Lon. <?php  echo htmlspecialchars($online_user->lon) ?><?php  endif;?><?php  if ( !empty($online_user->visitor_tz) ) :?><br/>Time zone: <?php  echo htmlspecialchars($online_user->visitor_tz),' ',$online_user->visitor_tz_time ?><?php  endif;?><?php  if (!empty($online_user->identifier)) : ?><br/>Identifier - <?php  echo htmlspecialchars($online_user->identifier)?><?php  endif;?></p><?php  if ($online_user->online_attr != '') : ?><h5>Additional information</h5><pre><?php  echo htmlspecialchars(json_encode(json_decode($online_user->online_attr),JSON_PRETTY_PRINT));?></pre><?php  endif;?></div><?php   ?><h5>Last activity <?php  echo htmlspecialchars($online_user->lastactivity_ago)?> ago<?php  $timeoutOnPage = (int)'0'; if ($timeoutOnPage > 0) : ?>,<br/><b>On page - <?php  if ($online_user->last_check_time_ago < ($timeoutOnPage+3)) : ?><i class="icon-user-status material-icons icon-user-online" title="Yes">face</i><?php  else : ?><i class="icon-user-status material-icons" title="No">face</i><?php  endif;?></b><?php  endif;?></h5><ul class="list-unstyled"><li><i class="material-icons">face</i><?php  if ($online_user->message_seen == 0) : ?><?php  if ($online_user->operator_message == '') : ?>User does not have any message from operator<?php  else : ?>User have not seen message from operator, or message window still open.<?php  endif; ?><?php  else : ?>User has seen message from operator.<?php  endif; ?></li><li><?php  if ($online_user->chat_id > 0) : ?><?php  if ($online_user->can_view_chat == true) : ?><a href="#" onclick="return lhc.previewChat('<?php  echo $online_user->chat_id?>');"><?php  endif;?><i class="material-icons chat-active">chat</i>User is chatting<?php  if ($online_user->can_view_chat == true) : ?></a><?php  endif;?><?php  else : ?><i class="material-icons">chat</i>User is not having any chat right now<?php  endif; ?></li><li><i title="Operator" class="material-icons">account_box</i><?php  if ( ($operator_user = $online_user->operator_user) !== false ) : ?><?php  echo htmlspecialchars($operator_user); ?> has send message to user<?php  else : ?>No one has send any message to user yet<?php  endif; ?></li><li>First visit - <?php  echo $online_user->first_visit_front?></li><li>Last visit - <?php  echo $online_user->last_visit_front?></li><li>Total visits - <?php  echo $online_user->total_visits?></li><li><?php  echo $online_user->invitation_count?> time(s) invitation logic was applied</li><li>Pageviews - <?php  echo $online_user->pages_count?></li><li>Total pageviews - <?php  echo $online_user->tt_pages_count?></li><li>Time on site - <?php  echo $online_user->time_on_site_front?></li><li>Total time on site - <?php  echo $online_user->tt_time_on_site_front?></li><li>Current page - <a target="_blank" rel="noopener" href="<?php  echo htmlspecialchars($online_user->current_page)?>" title="<?php  echo htmlspecialchars($online_user->current_page)?>"><?php  echo erLhcoreClassDesign::shrt($online_user->current_page,100,100);?></a></li><li>Came from - <a target="_blank" rel="noopener" href="<?php  echo htmlspecialchars($online_user->referrer)?>"><?php  echo htmlspecialchars($online_user->referrer)?></a></li><li class="fs11"><i class="material-icons">language</i><?php  echo htmlspecialchars($online_user->user_agent)?></li></ul></div></div><?php  endif;?><?php  $information_tab_online_user_info_chats_enabled = true?><?php  if ($information_tab_online_user_info_chats_enabled == true) : ?><div role="tabpanel" class="tab-pane" id="online-user-info-chats-tab-<?php  echo $chat->id?>"><ul class="foot-print-content list-unstyled" style="max-height: 170px;"><?php  $hasPrevChat = false; foreach (erLhcoreClassChat::getList(array('limit' => 100, 'filter' => array('online_user_id' => $online_user->id))) as $chatPrev) : ?><?php  if (!isset($chat) || $chat->id != $chatPrev->id) : $hasPrevChat = true;?><li><?php  if ( !empty($chatPrev->country_code) ) : ?><img src="/zcodialawfirm/ztchat/design/defaulttheme/images/flags/<?php  echo $chatPrev->country_code?>.png" alt="<?php  echo htmlspecialchars($chatPrev->country_name)?>" title="<?php  echo htmlspecialchars($chatPrev->country_name)?>" />&nbsp;<?php  endif; ?><a title="Open in a new window" class="material-icons" onclick="lhinst.startChatNewWindow('<?php  echo $chatPrev->id;?>',$(this).attr('data-title'))" data-title="<?php  echo htmlspecialchars($chatPrev->nick,ENT_QUOTES);?>">open_in_new</a><?php  echo $chatPrev->id;?>. <?php  echo htmlspecialchars($chatPrev->nick);?> (<?php  echo date(erLhcoreClassModule::$dateDateHourFormat,$chatPrev->time);?>) (<?php  echo htmlspecialchars($chatPrev->department);?>)</li><?php  endif; ?><?php  endforeach;?></ul><?php  if ($hasPrevChat == false) : ?>No previous chats<?php  endif;?></div><?php  endif; ?><?php  endif; ?><?php   ?></div></div><?php   ?></div></div><script type="text/javascript">lhinst.addAdminChatFinished(<?php  echo $chat->id;?>,<?php  echo $LastMessageID?>,<?php  isset($arg) ? print json_encode($arg) : print 'null'?>);</script>